# Фаза 4: Scale

> Оптимизация под нагрузку и расширение функционала.

**Длительность:** Ongoing (параллельно с Фазой 3+)

**Зависимости:** Может начинаться после Фазы 2

---

## Цели

1. Быстрый поиск и витрина
2. Аналитика и дашборды
3. Несколько провайдеров доставки
4. Полная observability

---

## Этапы

| Этап | Название | Что делаем |
|------|----------|------------|
| 1 | Кэширование | Redis Cache для STOREFRONT |
| 2 | Поиск | ElasticSearch вместо Atlas Search |
| 3 | Аналитика | ANALYTICS модуль, ClickHouse |
| 4 | Логистика | SLA, fallback провайдеры |
| 5 | Observability | OpenTelemetry полный |
| 6 | Data | Retention policies, архивация |

---

## Этап 1: Кэширование

**Задачи:**
- Redis Cache для ShopProduct листингов
- Cache invalidation при изменении
- TTL стратегия по типам данных

**Детали:** [stage-1.md](./stage-1.md) *(после утверждения)*

---

## Этап 2: Поиск (ElasticSearch)

**Задачи:**
- ES индекс для товаров
- Синхронизация INVENTORY → ES
- Фасетный поиск
- Автокомплит
- Фильтры по city

**Детали:** [stage-2.md](./stage-2.md) *(после утверждения)*

---

## Этап 3: Аналитика (ANALYTICS)

**Сущности:** Event (ClickHouse)

**Задачи:**
- Сбор событий (просмотры, клики, добавления)
- ETL: MongoDB → ClickHouse
- Дашборды: GMV, Revenue, конверсия
- Отчёты для селлеров

**Детали:** [stage-3.md](./stage-3.md) *(после утверждения)*

---

## Этап 4: Логистика расширенная

**Задачи:**
- SLA по времени доставки
- Fallback провайдеры (СДЭК, DPD)
- Выбор оптимального провайдера
- Трекинг от 3PL

**Детали:** [stage-4.md](./stage-4.md) *(после утверждения)*

---

## Этап 5: Observability

**Задачи:**
- OpenTelemetry: traces, metrics, logs
- Distributed tracing
- SLO/SLI определение
- Алерты на нарушение SLO

**Детали:** [stage-5.md](./stage-5.md) *(после утверждения)*

---

## Этап 6: Data Lifecycle

**Задачи:**
- TTL для AUDIT логов
- Архивация старых заказов
- GDPR: удаление данных по запросу
- Бэкапы и восстановление

**Детали:** [stage-6.md](./stage-6.md) *(после утверждения)*

---

## Критерии готовности

- [ ] Витрина отвечает <100ms (p99)
- [ ] ES поиск работает
- [ ] Дашборды показывают GMV/Revenue
- [ ] Fallback доставка работает
- [ ] Трейсы видны в Jaeger/Grafana
