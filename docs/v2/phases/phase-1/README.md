# Фаза 1: MVP Core

> Минимальный продукт — клиент может заказать товар и получить доставку.

**Длительность:** 4-6 недель

---

## Цели

1. Покупатель может зарегистрироваться и войти
2. Покупатель видит каталог товаров
3. Покупатель может оформить заказ
4. Сотрудник магазина может принять и собрать заказ
5. Курьер может доставить заказ
6. Все стороны получают уведомления

---

## Этапы

| Этап | Название | Модули | Что делаем |
|------|----------|--------|------------|
| 1 | Аутентификация | AUTH | JWT, OTP, Telegram OAuth, Guards |
| 2 | Пользователи | CUSTOMER, BUSINESS | Профили покупателей, селлеры, магазины |
| 3 | Каталог | CATALOG, STOREFRONT | Категории, товары, витрина, поиск |
| 4 | Склад | INVENTORY | Остатки, резервирование, OCC |
| 5 | Заказы | ORDERS | Корзина, checkout, FSM статусов |
| 6 | Персонал | WORKFORCE | Сотрудники, смены |
| 7 | Доставка | LOGISTICS, GEO | Доставка, зоны, геокодинг |
| 8 | Уведомления | COMMUNICATIONS | Telegram, SMS, очереди |
| 9 | Интеграция | — | E2E флоу, BFF endpoints |

---

## Этап 1: Аутентификация (AUTH)

**Модуль:** AUTH

**Сущности:** OTP, RefreshToken

**Задачи:**
- JWT access/refresh токены
- OTP через SMS/Telegram
- Telegram OAuth
- Rate limiting: 10 req/min

**Детали:** [stage-1.md](./stage-1.md) *(после утверждения)*

---

## Этап 2: Пользователи (CUSTOMER, BUSINESS)

**Модули:** CUSTOMER, BUSINESS

**Сущности:** Customer, Address, Seller, Shop

**Задачи:**
- CRUD профилей
- Адреса доставки
- Селлеры и магазины
- city в сущностях

**Детали:** [stage-2.md](./stage-2.md) *(после утверждения)*

---

## Этап 3: Каталог (CATALOG, STOREFRONT)

**Модули:** CATALOG, STOREFRONT

**Сущности:** Category, Product, ShopProduct

**Задачи:**
- Категории (дерево)
- Мастер-товары
- Витрина магазина (ShopProduct)
- MongoDB Atlas Search

**Детали:** [stage-3.md](./stage-3.md) *(после утверждения)*

---

## Этап 4: Склад (INVENTORY)

**Модуль:** INVENTORY

**Сущности:** Stock, Reserve, StockMovement

**Задачи:**
- Остатки по SKU
- Резервирование при checkout
- OCC через version
- Базовые партии (Batch)

**Детали:** [stage-4.md](./stage-4.md) *(после утверждения)*

---

## Этап 5: Заказы (ORDERS)

**Модуль:** ORDERS

**Сущности:** Cart, Order, OrderItem

**Задачи:**
- Корзина CRUD
- Checkout (Cart → Order)
- FSM статусов
- Tolerance ±10%

**Детали:** [stage-5.md](./stage-5.md) *(после утверждения)*

---

## Этап 6: Персонал (WORKFORCE)

**Модуль:** WORKFORCE

**Сущности:** Employee, Shift

**Задачи:**
- Сотрудники магазина
- Смены (открытие/закрытие)
- Привязка заказов к смене

**Детали:** [stage-6.md](./stage-6.md) *(после утверждения)*

---

## Этап 7: Доставка (LOGISTICS, GEO)

**Модули:** LOGISTICS, GEO

**Сущности:** Delivery, DeliveryZone

**Задачи:**
- Создание доставки
- Зоны доставки (полигоны)
- Геокодинг (DaData)
- Расчёт стоимости

**Детали:** [stage-7.md](./stage-7.md) *(после утверждения)*

---

## Этап 8: Уведомления (COMMUNICATIONS)

**Модуль:** COMMUNICATIONS

**Задачи:**
- Telegram Bot уведомления
- SMS для OTP
- Шаблоны сообщений
- Очередь отправки (BullMQ)

**Детали:** [stage-8.md](./stage-8.md) *(после утверждения)*

---

## Этап 9: Интеграция

**Задачи:**
- E2E флоу: Регистрация → Каталог → Заказ → Доставка
- BFF aggregate endpoints
- Тестирование city изоляции

**Детали:** [stage-9.md](./stage-9.md) *(после утверждения)*

---

## Критерии готовности

- [ ] Полный E2E флоу работает
- [ ] Уведомления приходят всем сторонам
- [ ] Rate limiting работает
- [ ] city изоляция работает
