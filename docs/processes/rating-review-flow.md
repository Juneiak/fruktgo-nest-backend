# –ü—Ä–æ—Ü–µ—Å—Å: –†–µ–π—Ç–∏–Ω–≥–∏ –∏ –æ—Ç–∑—ã–≤—ã

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** Customer, Seller, Shop, PlatformStaff  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Order Module, Rating Module, Moderation Module

---

## –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

–ü–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å **–æ—Ç–∑—ã–≤**: –æ—Ü–µ–Ω–∫–∞ 1-5 –∑–≤—ë–∑–¥, –±—ã—Å—Ç—Ä—ã–µ —Ç–µ–≥–∏, —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, —Ñ–æ—Ç–æ. –û—Ç–∑—ã–≤—ã –ø—Ä–æ—Ö–æ–¥—è—Ç **–º–æ–¥–µ—Ä–∞—Ü–∏—é** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è ‚â•4 –∑–≤—ë–∑–¥, –≤—Ä—É—á–Ω—É—é –¥–ª—è ‚â§2 –∑–≤—ë–∑–¥). –ú–∞–≥–∞–∑–∏–Ω –º–æ–∂–µ—Ç **–æ—Ç–≤–µ—Ç–∏—Ç—å** –Ω–∞ –æ—Ç–∑—ã–≤. –†–µ–π—Ç–∏–Ω–≥ –º–∞–≥–∞–∑–∏–Ω–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ **–∫–æ–º–∏—Å—Å–∏—é**: —Ö–æ—Ä–æ—à–∏–π —Ä–µ–π—Ç–∏–Ω–≥ ‚Üí —Å–∫–∏–¥–∫–∞, –ø–ª–æ—Ö–æ–π ‚Üí –Ω–∞–¥–±–∞–≤–∫–∞.

**–°—Ö–µ–º–∞:** –î–æ—Å—Ç–∞–≤–∫–∞ ‚Üí –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ—Ç–∑—ã–≤ ‚Üí –∫–ª–∏–µ–Ω—Ç –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç ‚Üí –º–æ–¥–µ—Ä–∞—Ü–∏—è ‚Üí –ø—É–±–ª–∏–∫–∞—Ü–∏—è ‚Üí –æ—Ç–≤–µ—Ç –º–∞–≥–∞–∑–∏–Ω–∞.

### –ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞

**–û—Ü–µ–Ω–∫–∞ –∑–∞–∫–∞–∑–∞:**
- –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –¥–Ω–µ–π –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: —Ä–µ–π—Ç–∏–Ω–≥ 1-5 –∑–≤—ë–∑–¥
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ç–µ–≥–∏ (–±—ã—Å—Ç—Ä–∞—è –æ—Ü–µ–Ω–∫–∞), –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, —Ñ–æ—Ç–æ
- –ü—Ä–∏ —Ä–µ–π—Ç–∏–Ω–≥–µ ‚â§2 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

**–ú–æ–¥–µ—Ä–∞—Ü–∏—è:**
- ‚â•4 –∑–≤—ë–∑–¥ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ (`APPROVED`)
- ‚â§2 –∑–≤—ë–∑–¥ ‚Äî —Ä—É—á–Ω–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è (`PENDING`)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∞—Ç, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è, —Å–ø–∞–º
- –û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è

**–û—Ç–≤–µ—Ç –º–∞–≥–∞–∑–∏–Ω–∞:**
- –ú–∞–≥–∞–∑–∏–Ω –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –æ—Ç–∑—ã–≤ (–¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤)
- –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Ç–∑—ã–≤
- –ü–æ–≤—ã—à–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç–∏ –º–∞–≥–∞–∑–∏–Ω–∞

**–ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –º–∞–≥–∞–∑–∏–Ω–∞:**
- –°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω—ã–π —Å —É—á—ë—Ç–æ–º —Å–≤–µ–∂–µ—Å—Ç–∏: 70% –æ–±—â–∏–π + 30% –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ (—Å–∫–æ–ª—å–∫–æ 5‚òÖ, 4‚òÖ, 3‚òÖ, 2‚òÖ, 1‚òÖ)
- –¢–æ–ø –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö/–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ç–µ–≥–æ–≤

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–æ–º–∏—Å—Å–∏—é:**
- –†–µ–π—Ç–∏–Ω–≥ ‚â•4.9 ‚Üí —Å–∫–∏–¥–∫–∞ -2%
- –†–µ–π—Ç–∏–Ω–≥ <3.5 ‚Üí –Ω–∞–¥–±–∞–≤–∫–∞ +3%
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –µ–∂–µ–º–µ—Å—è—á–Ω–æ

### –ë–æ–Ω—É—Å—ã –∑–∞ –æ—Ç–∑—ã–≤—ã

–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç +20 –±–∞–ª–ª–æ–≤ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∑–∞ –ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ –≤ –æ—Ç–∑—ã–≤–µ. –≠—Ç–æ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã —Å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏.

---

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–æ–∫ –∏ –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤, –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø—Ä—è–º—ã–º –≤–ª–∏—è–Ω–∏–µ–º –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏ –∏ –≤–∏–¥–∏–º–æ—Å—Ç—å.

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- –û—Ç–∑—ã–≤—ã —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏ (`DELIVERED`)
- –°—Ä–æ–∫ –æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞: **–¥–æ 30 –¥–Ω–µ–π**
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ (‚â§2 –∑–≤–µ–∑–¥—ã)
- **–ü—Ä—è–º–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–æ–º–∏—Å—Å–∏—é** –º–∞–≥–∞–∑–∏–Ω–∞ (¬±2-3%)
- –ë–æ–Ω—É—Å—ã –∑–∞ –æ—Ç–∑—ã–≤—ã —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ (+20 –±–∞–ª–ª–æ–≤)

**–ß—Ç–æ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è:**
- –ó–∞–∫–∞–∑ (1-5 –∑–≤—ë–∑–¥ + —Ç–µ–≥–∏ + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π)
- –ú–∞–≥–∞–∑–∏–Ω (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –∏–∑ –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ –∑–∞–∫–∞–∑—ã)
- –¢–æ–≤–∞—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤ –±—É–¥—É—â–µ–º)

---

## 1. –û—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–º

**–ê–∫—Ç–æ—Ä:** Customer

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω ‚Üí —Å—Ç–∞—Ç—É—Å `DELIVERED`
2. –ß–µ—Ä–µ–∑ 1 —á–∞—Å –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–û—Ü–µ–Ω–∏—Ç–µ –≤–∞—à –∑–∞–∫–∞–∑ #12345"
3. –ö–ª–∏–µ–Ω—Ç –≤ –ø–∞–Ω–µ–ª–∏ ‚Üí "–ó–∞–∫–∞–∑—ã" ‚Üí –≤—ã–±–æ—Ä –∑–∞–∫–∞–∑–∞ ‚Üí "–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤"
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π:**
   - –ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω ‚úì
   - –ü—Ä–æ—à–ª–æ –º–µ–Ω–µ–µ 30 –¥–Ω–µ–π ‚úì
   - –û—Ç–∑—ã–≤ –µ—â—ë –Ω–µ –æ—Å—Ç–∞–≤–ª–µ–Ω ‚úì
5. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã:
   - **–û—Ü–µ–Ω–∫–∞:** 1-5 –∑–≤—ë–∑–¥ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - **–ë—ã—Å—Ç—Ä—ã–µ —Ç–µ–≥–∏:** –≤—ã–±–æ—Ä –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:** —Ç–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞ (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø—Ä–∏ rating ‚â§2)
   - **–§–æ—Ç–æ:** –¥–æ 5 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, +20 –±–∞–ª–ª–æ–≤ –∑–∞ –ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ)
6. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç `OrderRating`:
   ```typescript
   {
     order: orderId,
     settedRating: 4,
     feedbackAt: new Date(),
     feedbackTags: ["FRESH_PRODUCTS", "FAST_DELIVERY"],
     feedbackComment: "–û—Ç–ª–∏—á–Ω—ã–µ —Ñ—Ä—É–∫—Ç—ã, –±—ã—Å—Ç—Ä–æ –¥–æ—Å—Ç–∞–≤–∏–ª–∏!",
     photos: ["photo1.jpg", "photo2.jpg"],
     moderation: {
       status: "APPROVED"  // –ê–≤—Ç–æ–º–æ–¥–µ—Ä–∞—Ü–∏—è –¥–ª—è ‚â•4 –∑–≤—ë–∑–¥
     }
   }
   ```
7. **–ë–æ–Ω—É—Å—ã:**
   - –ó–∞ –æ—Ç–∑—ã–≤ —Å —Ñ–æ—Ç–æ: +20 –±–∞–ª–ª–æ–≤ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
8. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è:**
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–µ–π—Ç–∏–Ω–≥ –º–∞–≥–∞–∑–∏–Ω–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–º–∏—Å—Å–∏—è (–µ—Å–ª–∏ —Ä–µ–π—Ç–∏–Ω–≥ –∏–∑–º–µ–Ω–∏–ª—Å—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ)
9. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - –°–µ–ª–ª–µ—Ä—É: "–ù–æ–≤—ã–π –æ—Ç–∑—ã–≤ –Ω–∞ –∑–∞–∫–∞–∑ #12345 ‚Ä¢ ‚≠ê‚≠ê‚≠ê‚≠ê"

**API:** `POST /customer/orders/:id/review`

### –¢–µ–≥–∏ –±—ã—Å—Ç—Ä–æ–π –æ—Ü–µ–Ω–∫–∏

**–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `GOOD_QUALITY` - –•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- `FRESH_PRODUCTS` - –°–≤–µ–∂–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã
- `FAST_DELIVERY` - –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
- `GOOD_PRICE` - –•–æ—Ä–æ—à–∞—è —Ü–µ–Ω–∞
- `POLITE_COURIER` - –í–µ–∂–ª–∏–≤—ã–π –∫—É—Ä—å–µ—Ä

**–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ:**
- `DELAYED_DELIVERY` - –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
- `LOW_QUALITY` - –ü–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- `DAMAGED_PACKAGING` - –ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞
- `WRONG_ITEMS` - –ù–µ —Ç–æ—Ç —Ç–æ–≤–∞—Ä
- `RUDE_COURIER` - –ì—Ä—É–±—ã–π –∫—É—Ä—å–µ—Ä

---

## 2. –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤

**–ê–∫—Ç–æ—Ä:** PlatformStaff (–¥–ª—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö) –∏–ª–∏ –°–∏—Å—Ç–µ–º–∞ (–∞–≤—Ç–æ–º–æ–¥–µ—Ä–∞—Ü–∏—è)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è

1. –û—Ç–∑—ã–≤ —Å–æ–∑–¥–∞–Ω ‚Üí —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   ```typescript
   if (rating >= 4) {
     moderation.status = "APPROVED";  // –ê–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–∏–µ
   } else if (containsProfanity(comment)) {
     moderation.status = "REJECTED";
     moderation.reason = "–ù–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞";
   } else if (rating <= 2) {
     moderation.status = "PENDING";  // –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
   }
   ```
2. **–ê–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–∏–µ** –¥–ª—è rating ‚â•4 (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–∑—ã–≤—ã)
3. **–ê–≤—Ç–æ–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ** –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –º–∞—Ç–∞/—Å–ø–∞–º–∞
4. **–†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –¥–ª—è rating ‚â§2 (–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ)

### –†—É—á–Ω–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è (–¥–ª—è rating ‚â§2)

1. –ê–¥–º–∏–Ω –≤ `/platform/reviews?status=PENDING`
2. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –æ—Ç–∑—ã–≤:
   - –¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
   - –û—Ü–µ–Ω–∫–∞
   - –¢–µ–≥–∏
   - –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞
3. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ:

**–û–¥–æ–±—Ä–∏—Ç—å:**
```typescript
{
  moderation: {
    status: "APPROVED",
    moderatedBy: adminId,
    moderatedAt: new Date()
  }
}
```

**–û—Ç–∫–ª–æ–Ω–∏—Ç—å:**
```typescript
{
  moderation: {
    status: "REJECTED",
    reason: "–û—Ç–∑—ã–≤ –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∑–∞–∫–∞–∑—É",
    moderatedBy: adminId,
    moderatedAt: new Date()
  }
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:**
- –ù–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞
- –û—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è
- –°–ø–∞–º/—Ä–µ–∫–ª–∞–º–∞
- –û—Ç–∑—ã–≤ –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∑–∞–∫–∞–∑—É
- –î—É–±–ª–∏—Ä—É—é—â–∏–π –æ—Ç–∑—ã–≤

**API:** `POST /platform/reviews/:id/moderate`

---

## 3. –û—Ç–≤–µ—Ç –º–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞ –æ—Ç–∑—ã–≤

**–ê–∫—Ç–æ—Ä:** Seller

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –°–µ–ª–ª–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –æ—Ç–∑—ã–≤–µ
2. –í –ø–∞–Ω–µ–ª–∏ `/seller/reviews` ‚Üí –ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç–∑—ã–≤–æ–≤
3. –í—ã–±–∏—Ä–∞–µ—Ç –æ—Ç–∑—ã–≤ ‚Üí "–û—Ç–≤–µ—Ç–∏—Ç—å"
4. –ü–∏—à–µ—Ç –æ—Ç–≤–µ—Ç (–¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤):
   ```typescript
   {
     shopResponse: {
       comment: "–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –æ—Ç–∑—ã–≤! –†–∞–¥—ã, —á—Ç–æ –≤—Å—ë –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å",
       respondedAt: new Date(),
       respondedBy: sellerId
     }
   }
   ```
5. **–ü—Ä–∞–≤–∏–ª–∞:**
   - –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Ç–∑—ã–≤
   - –ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
   - –û—Ç–≤–µ—Ç –≤–∏–¥–µ–Ω –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
6. **–í–ª–∏—è–Ω–∏–µ:**
   - –ü–æ–≤—ã—à–∞–µ—Ç `shop.responseRate` (% –æ—Ç–∑—ã–≤–æ–≤ —Å –æ—Ç–≤–µ—Ç–æ–º)
   - –£–ª—É—á—à–∞–µ—Ç –∏–º–∏–¥–∂ –º–∞–≥–∞–∑–∏–Ω–∞

**API:** `POST /seller/reviews/:id/respond`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—Ç–≤–µ—Ç–∞–º:**
- –ë–ª–∞–≥–æ–¥–∞—Ä–∏—Ç—å –∑–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–∑—ã–≤—ã
- –ò–∑–≤–∏–Ω—è—Ç—å—Å—è –∏ –æ–±—ä—è—Å–Ω—è—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é –ø—Ä–∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö
- –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (—Å–∫–∏–¥–∫–∞, –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è)
- –ë—ã—Ç—å –≤–µ–∂–ª–∏–≤—ã–º –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º

---

## 4. –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –º–∞–≥–∞–∑–∏–Ω–∞

**–ê–∫—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –æ—Ç–∑—ã–≤–µ)

### –†–∞—Å—á—ë—Ç –æ–±—â–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞

```typescript
function calculateShopRating(shop: Shop) {
  const allReviews = await OrderRating.find({ shop: shop._id, "moderation.status": "APPROVED" });
  
  // –°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
  const totalRating = allReviews.reduce((sum, r) => sum + r.settedRating, 0);
  const averageRating = totalRating / allReviews.length;
  
  // –ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü (–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π)
  const recentReviews = allReviews.filter(r => isWithinLastMonth(r.feedbackAt));
  const recentAverage = recentReviews.reduce((sum, r) => sum + r.settedRating, 0) / recentReviews.length;
  
  // –ò—Ç–æ–≥–æ–≤—ã–π: 70% –æ–±—â–∏–π + 30% –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
  const overall = averageRating * 0.7 + recentAverage * 0.3;
  
  // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
  let adjusted = overall;
  if (allReviews.length > 100) adjusted += 0.1;  // –ë–æ–Ω—É—Å –∑–∞ –º–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–æ–≤
  if (shop.responseRate < 50) adjusted -= 0.2;   // –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–∏–∑–∫—É—é –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å
  
  return Math.min(5, Math.max(1, adjusted));  // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 1-5
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ ShopRating

```typescript
{
  overall: 4.7,  // –û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥
  totalReviews: 234,
  distribution: {
    5: 150,  // 150 –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ 5 –∑–≤—ë–∑–¥
    4: 60,
    3: 15,
    2: 5,
    1: 4
  },
  reviewRate: 45,  // 45% –∑–∞–∫–∞–∑–æ–≤ –æ—Ü–µ–Ω–µ–Ω—ã
  responseRate: 78,  // 78% –æ—Ç–∑—ã–≤–æ–≤ —Å –æ—Ç–≤–µ—Ç–æ–º
  topPositiveTags: [
    { tag: "FRESH_PRODUCTS", count: 180 },
    { tag: "FAST_DELIVERY", count: 120 }
  ],
  topNegativeTags: [
    { tag: "DELAYED_DELIVERY", count: 15 },
    { tag: "DAMAGED_PACKAGING", count: 8 }
  ],
  lastUpdated: new Date()
}
```

---

## 5. –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–æ–º–∏—Å—Å–∏—é

**–ê–∫—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–∞ (–ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞)

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –∫–æ–º–∏—Å—Å–∏–∏

```typescript
function getCommissionAdjustment(shopRating: number): number {
  if (shopRating >= 4.9) return -2;  // –°–∫–∏–¥–∫–∞ 2%
  if (shopRating >= 4.7) return -1;  // –°–∫–∏–¥–∫–∞ 1%
  if (shopRating >= 4.5) return 0;   // –°—Ç–∞–Ω–¥–∞—Ä—Ç
  if (shopRating >= 3.5) return 0;   // –°—Ç–∞–Ω–¥–∞—Ä—Ç
  return +3;  // –ù–∞–¥–±–∞–≤–∫–∞ 3% –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞ <3.5
}
```

### –¢–∞–±–ª–∏—Ü–∞ –≤–ª–∏—è–Ω–∏—è

| –†–µ–π—Ç–∏–Ω–≥ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ | –ü—Ä–∏–º–µ—Ä (–±–∞–∑–æ–≤–∞—è 20%) |
|---------|-------------------|----------------------|
| ‚â•4.9 | **-2%** | 18% |
| 4.7-4.8 | **-1%** | 19% |
| 4.5-4.6 | 0% | 20% |
| 3.5-4.4 | 0% | 20% |
| <3.5 | **+3%** | 23% |

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ö–æ–º–∏—Å—Å–∏—è –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ä–∞—Å—á—ë—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ —Å —É—á—ë—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞.

---

## 6. –ë–µ–π–¥–∂–∏ –∏ –≤–∏–¥–∏–º–æ—Å—Ç—å

**–ê–∫—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### –ë–µ–π–¥–∂–∏ –º–∞–≥–∞–∑–∏–Ω–∞

```typescript
const badges = [];

if (shop.rating >= 4.8 && shop.totalReviews >= 100) {
  badges.push("TOP_RATED");  // ‚≠ê –í—ã—Å—à–∏–π —Ä–µ–π—Ç–∏–Ω–≥
}

if (shop.responseRate >= 90) {
  badges.push("RESPONSIVE");  // üí¨ –û—Ç–∑—ã–≤—á–∏–≤—ã–π
}

if (shop.qualityComplaints < 5) {  // <5% –∂–∞–ª–æ–± –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ
  badges.push("QUALITY_ASSURED");  // ‚úì –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
}
```

### –í–ª–∏—è–Ω–∏–µ –Ω–∞ –≤–∏–¥–∏–º–æ—Å—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ

–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤ —Å —É—á—ë—Ç–æ–º —Ä–µ–π—Ç–∏–Ω–≥–∞:

```typescript
// –ë–∞–ª–ª –¥–ª—è —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è
score = rating * Math.log(reviewCount + 1) * distanceModifier
```

**–§–∞–∫—Ç–æ—Ä—ã:**
- –í—ã—Å–æ–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥ ‚Üí –≤—ã—à–µ –≤ —Å–ø–∏—Å–∫–µ
- –ú–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–æ–≤ ‚Üí –±–æ–ª—å—à–µ –¥–æ–≤–µ—Ä–∏—è
- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ ‚Üí –±–ª–∏–∂–µ –≤–∞–∂–Ω–µ–µ

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–≤–æ–¥–∫–∞

### –°—É—â–Ω–æ—Å—Ç—å OrderRating

```typescript
{
  order: ObjectId,
  settedRating: number,  // 1-5
  feedbackAt: Date,
  feedbackTags: FeedbackTag[],
  feedbackComment: string,
  photos: string[],
  shopResponse?: {
    comment: string,
    respondedAt: Date,
    respondedBy: ObjectId
  },
  moderation: {
    status: "PENDING" | "APPROVED" | "REJECTED",
    reason?: string,
    moderatedBy?: ObjectId,
    moderatedAt?: Date
  }
}
```

### –°—É—â–Ω–æ—Å—Ç—å ShopRating (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)

```typescript
{
  shop: ObjectId,
  overall: number,
  totalReviews: number,
  distribution: Record<1|2|3|4|5, number>,
  reviewRate: number,
  responseRate: number,
  topPositiveTags: Array<{ tag: string, count: number }>,
  topNegativeTags: Array<{ tag: string, count: number }>,
  badges: string[],
  lastUpdated: Date
}
```

### API

**Customer:**
- `POST /customer/orders/:id/review` - –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
- `PATCH /customer/reviews/:id` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (24 —á–∞—Å–∞)
- `GET /customer/reviews` - –º–æ–∏ –æ—Ç–∑—ã–≤—ã

**Seller:**
- `GET /seller/reviews` - –æ—Ç–∑—ã–≤—ã –Ω–∞ –∑–∞–∫–∞–∑—ã –º–æ–∏—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤
- `POST /seller/reviews/:id/respond` - –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –æ—Ç–∑—ã–≤
- `GET /seller/shops/:id/rating` - –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –º–∞–≥–∞–∑–∏–Ω–∞
- `GET /seller/analytics/reviews` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—Ç–∑—ã–≤–æ–≤

**Public:**
- `GET /shops/:id/reviews` - –ø—É–±–ª–∏—á–Ω—ã–µ –æ—Ç–∑—ã–≤—ã –º–∞–≥–∞–∑–∏–Ω–∞
- `GET /shops/:id/rating` - —Ä–µ–π—Ç–∏–Ω–≥ –º–∞–≥–∞–∑–∏–Ω–∞

**Platform:**
- `GET /platform/reviews?status=PENDING` - –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- `POST /platform/reviews/:id/moderate` - –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
- `GET /platform/reviews/analytics` - –æ–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞

1. **–¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏:** –æ—Ç–∑—ã–≤ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è `DELIVERED` –∑–∞–∫–∞–∑–æ–≤
2. **–°—Ä–æ–∫:** –¥–æ 30 –¥–Ω–µ–π –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏
3. **–û–¥–∏–Ω –æ—Ç–∑—ã–≤ –Ω–∞ –∑–∞–∫–∞–∑:** –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É (—Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ —Ç–µ—á–µ–Ω–∏–µ 24—á)
4. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:** –ø—Ä–∏ rating ‚â§2 –∑–≤—ë–∑–¥
5. **–ê–≤—Ç–æ–º–æ–¥–µ—Ä–∞—Ü–∏—è:** rating ‚â•4 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä—è–µ—Ç—Å—è
6. **–†—É—á–Ω–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è:** rating ‚â§2 —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–æ–º
7. **–ë–æ–Ω—É—Å:** +20 –±–∞–ª–ª–æ–≤ –∑–∞ –ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ –≤ –æ—Ç–∑—ã–≤–µ
8. **–û–¥–∏–Ω –æ—Ç–≤–µ—Ç:** –º–∞–≥–∞–∑–∏–Ω –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
9. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞:** –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤
10. **–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–æ–º–∏—Å—Å–∏—é:** –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ä–∞—Å—á—ë—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞

---

## –ü—Ä–∏–º–µ—Ä—ã

### –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–∑—ã–≤

```typescript
// –ö–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–∑—ã–≤
await ratingPort.createReview({
  orderId,
  settedRating: 5,
  feedbackTags: ["FRESH_PRODUCTS", "FAST_DELIVERY"],
  feedbackComment: "–í—Å—ë —Å—É–ø–µ—Ä! –Ø–±–ª–æ–∫–∏ —Å–ª–∞–¥–∫–∏–µ –∏ —Å–≤–µ–∂–∏–µ",
  photos: ["photo1.jpg"]
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
// - moderation.status = APPROVED
// - +20 –±–∞–ª–ª–æ–≤ –∑–∞ —Ñ–æ—Ç–æ
// - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ shop.rating
// - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–µ–ª–ª–µ—Ä—É
```

### –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–∑—ã–≤ —Å –æ—Ç–≤–µ—Ç–æ–º

```typescript
// 1. –ö–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞–≤–ª—è–µ—Ç
await ratingPort.createReview({
  orderId,
  settedRating: 2,
  feedbackTags: ["LOW_QUALITY", "DAMAGED_PACKAGING"],
  feedbackComment: "–£–ø–∞–∫–æ–≤–∫–∞ –ø–æ–º—è—Ç–∞, –ø–æ–ª–æ–≤–∏–Ω–∞ —Ç–æ–≤–∞—Ä–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞"
});
// ‚Üí moderation.status = PENDING

// 2. –ê–¥–º–∏–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –æ–¥–æ–±—Ä—è–µ—Ç
await ratingPort.moderateReview(reviewId, {
  status: "APPROVED"
});

// 3. –°–µ–ª–ª–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç
await ratingPort.respondToReview(reviewId, {
  comment: "–ü—Ä–∏–Ω–æ—Å–∏–º –∏–∑–≤–∏–Ω–µ–Ω–∏—è! –°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏"
});
```

---

## –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

**Order Flow:**
- –û—Ç–∑—ã–≤ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ `DELIVERED`
- –ó–∞–ø—Ä–æ—Å –Ω–∞ –æ—Ç–∑—ã–≤ —á–µ—Ä–µ–∑ 1 —á–∞—Å –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏

**Loyalty Flow:**
- –ë–æ–Ω—É—Å—ã –∑–∞ –æ—Ç–∑—ã–≤—ã —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ (+20 –±–∞–ª–ª–æ–≤)

**Commission Flow:**
- –†–µ–π—Ç–∏–Ω–≥ –º–∞–≥–∞–∑–∏–Ω–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ—Ü–µ–Ω—Ç –∫–æ–º–∏—Å—Å–∏–∏ (¬±2-3%)

**Dispute Flow:**
- –ù–∏–∑–∫–∏–µ –æ—Ü–µ–Ω–∫–∏ (‚â§2) –º–æ–≥—É—Ç –±—ã—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä–æ–º –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–ø–æ—Ä–∞

**Notification Flow:**
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–∞—Ö –¥–ª—è —Å–µ–ª–ª–µ—Ä–∞
- –ó–∞–ø—Ä–æ—Å –Ω–∞ –æ—Ç–∑—ã–≤ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

---

> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤  
> **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2024-11-24
