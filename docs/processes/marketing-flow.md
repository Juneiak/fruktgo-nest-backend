# –ü—Ä–æ—Ü–µ—Å—Å: –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥, –ø—Ä–æ–º–æ–∫–æ–¥—ã –∏ –∞–∫—Ü–∏–∏

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** Customer, Seller, PlatformStaff, MarketingManager  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Promo Module, Order Module, Loyalty Module, Analytics Module

---

## –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ **–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤: **–ø—Ä–æ–º–æ–∫–æ–¥—ã** (—Å–∫–∏–¥–∫–∏ –ø–æ –∫–æ–¥–∞–º), **–∞–∫—Ü–∏–∏** (–º–∞—Å—Å–æ–≤—ã–µ —Å–∫–∏–¥–∫–∏ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏), **–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è** (—Ç–∞—Ä–≥–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤), **—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞** (–ø—Ä–∏–≤–µ–¥–∏ –¥—Ä—É–≥–∞), **flash-sale** (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∏). –í—Å–µ –º–µ—Ö–∞–Ω–∏–∫–∏ –∏–º–µ—é—Ç –≥–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ª–æ–≤–∏–π –∏ –±—é–¥–∂–µ—Ç–∞.

**–°—Ö–µ–º–∞:** –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ ‚Üí –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å–ª–æ–≤–∏–π ‚Üí –∞–∫—Ç–∏–≤–∞—Ü–∏—è ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ ‚Üí –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

### –ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞

**–ü—Ä–æ–º–æ–∫–æ–¥—ã:**
- –¢–∏–ø—ã: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∫–∏–¥–∫–∞ (500‚ÇΩ), –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å–∫–∏–¥–∫–∞ (15%), –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞, –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
- –¢–∞—Ä–≥–µ—Ç–∏–Ω–≥: —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö/—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤/—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ú–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å –±–æ–Ω—É—Å–∞–º–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**–ê–∫—Ü–∏–∏:**
- –°–∫–∏–¥–∫–∞ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–æ–≤ –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
- –ê–∫—Ç–∏–≤–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (–Ω–µ—Ç –∫–æ–¥–∞)
- –ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∞–∫—Ü–∏—è–º–∏

**–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–¥–∞–≤–Ω–æ –Ω–µ –∑–∞–∫–∞–∑—ã–≤–∞–ª–∏, VIP, –Ω–æ–≤–∏—á–∫–∏)
- –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ push/email/telegram

**–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞:**
- –ü—Ä–∏–≥–ª–∞—Å–∏–≤—à–∏–π –ø–æ–ª—É—á–∞–µ—Ç +200 –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–∫–∞–∑–µ –¥—Ä—É–≥–∞
- –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç +100 –±–∞–ª–ª–æ–≤
- –£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞

**Flash-sale:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∏ (–æ–±—ã—á–Ω–æ 1-6 —á–∞—Å–æ–≤)
- –ë–æ–ª—å—à–∏–µ —Å–∫–∏–¥–∫–∏ (–¥–æ 50%)
- –õ–∏–º–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ –ø–æ –∞–∫—Ü–∏–∏
- –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ä–æ—á–Ω–æ—Å—Ç–∏

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–∞–º–ø–∞–Ω–∏–π

–î–ª—è –∫–∞–∂–¥–æ–π –∫–∞–º–ø–∞–Ω–∏–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π, –ø—Ä–∏–≤–ª–µ—á—ë–Ω–Ω–∞—è –≤—ã—Ä—É—á–∫–∞, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫, ROI. –ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ –≤–∏–¥–∏—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –º–æ–∂–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–∏—è.

---

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ–º–æ–∫–æ–¥—ã, –∞–∫—Ü–∏–∏, —Å–∫–∏–¥–∫–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å–ª–æ–≤–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- –ö–æ–Ω—Ç—Ä–æ–ª—å –±—é–¥–∂–µ—Ç–∞ –∏ –ª–∏–º–∏—Ç–æ–≤
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–º–ø–∞–Ω–∏–π
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã

**–¢–∏–ø—ã –ø—Ä–æ–º–æ-–º–µ—Ö–∞–Ω–∏–∫:**
- **–ü—Ä–æ–º–æ–∫–æ–¥—ã** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã –¥–ª—è —Å–∫–∏–¥–æ–∫
- **–ê–∫—Ü–∏–∏** - –º–∞—Å—Å–æ–≤—ã–µ —Å–∫–∏–¥–∫–∏ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/—Ç–æ–≤–∞—Ä—ã
- **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è** - –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞** - –ø—Ä–∏–≤–µ–¥–∏ –¥—Ä—É–≥–∞
- **Flash-sale** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∏
- **–ö—ç—à–±–µ–∫** - –≤–æ–∑–≤—Ä–∞—Ç –±–∞–ª–ª–æ–≤ (—Å–º. loyalty-flow.md)

---

## 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞

**–ê–∫—Ç–æ—Ä:** PlatformStaff / MarketingManager

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ –≤ –∞–¥–º–∏–Ω–∫–µ ‚Üí "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥" ‚Üí "–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥"
2. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
   ```typescript
   {
     code: "FRUIT2024",        // –ö–æ–¥ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
     type: "DISCOUNT_FIXED",   // –¢–∏–ø: DISCOUNT_FIXED | DISCOUNT_PERCENT | FREE_DELIVERY
     value: 500,               // 500‚ÇΩ –∏–ª–∏ 15%
     
     // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
     constraints: {
       minOrderAmount: 2000,   // –ú–∏–Ω. —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
       maxUses: 1000,          // –ú–∞–∫—Å. –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
       maxUsesPerUser: 1,      // –ú–∞–∫—Å. –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
       validFrom: "2024-12-01",
       validUntil: "2024-12-31",
       
       // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏/—Ç–æ–≤–∞—Ä—ã
       applicableCategories: ["–§—Ä—É–∫—Ç—ã", "–Ø–≥–æ–¥—ã"],
       excludedProducts: [productId1, productId2],
       
       // –°–µ–≥–º–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
       userSegments: ["NEW_USERS"],  // –¢–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ
       
       // –ì–µ–æ–≥—Ä–∞—Ñ–∏—è
       cities: ["–ê–ª–º–∞—Ç—ã", "–ê—Å—Ç–∞–Ω–∞"]
     },
     
     // –ë—é–¥–∂–µ—Ç
     budget: {
       total: 500000,          // –û–±—â–∏–π –±—é–¥–∂–µ—Ç –∫–∞–º–ø–∞–Ω–∏–∏
       perUser: 500            // –ú–∞–∫—Å. –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     },
     
     status: "ACTIVE",
     createdBy: marketingManagerId
   }
   ```
3. –°–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç:
   - –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ–¥–∞
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞—Ç
   - –ë—é–¥–∂–µ—Ç > 0
4. –ü—Ä–æ–º–æ–∫–æ–¥ —Å–æ–∑–¥–∞–Ω –∏ –∞–∫—Ç–∏–≤–µ–Ω
5. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:**
   ```typescript
   {
     promoCode: "FRUIT2024",
     stats: {
       totalUses: 0,
       totalDiscount: 0,
       totalRevenue: 0,
       uniqueUsers: 0,
       conversionRate: 0
     }
   }
   ```

**API:** `POST /platform/promo-codes`

### –¢–∏–ø—ã –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----|----------|--------|
| `DISCOUNT_FIXED` | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∫–∏–¥–∫–∞ –≤ ‚ÇΩ | 500‚ÇΩ —Å–∫–∏–¥–∫–∞ |
| `DISCOUNT_PERCENT` | –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å–∫–∏–¥–∫–∞ | 15% —Å–∫–∏–¥–∫–∞ |
| `FREE_DELIVERY` | –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ | –î–æ—Å—Ç–∞–≤–∫–∞ 0‚ÇΩ |
| `CASHBACK_BONUS` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫—ç—à–±–µ–∫ | +10% –±–∞–ª–ª–æ–≤ |
| `BUY_X_GET_Y` | –ö—É–ø–∏ X –ø–æ–ª—É—á–∏ Y | 2+1 –±–µ—Å–ø–ª–∞—Ç–Ω–æ |

---

## 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç–æ–º

**–ê–∫—Ç–æ—Ä:** Customer

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –ö–ª–∏–µ–Ω—Ç –≤ –∫–æ—Ä–∑–∏–Ω–µ ‚Üí "–í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥"
2. –í–≤–æ–¥–∏—Ç –∫–æ–¥: `FRUIT2024`
3. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   ```typescript
   async function validatePromoCode(code: string, order: Order, user: Customer) {
     const promo = await PromoCode.findOne({ code, status: "ACTIVE" });
     
     // –ü—Ä–æ–≤–µ—Ä–∫–∏
     if (!promo) return { valid: false, error: "–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω" };
     if (promo.validUntil < new Date()) return { valid: false, error: "–ü—Ä–æ–º–æ–∫–æ–¥ –∏—Å—Ç—ë–∫" };
     if (promo.currentUses >= promo.maxUses) return { valid: false, error: "–ü—Ä–æ–º–æ–∫–æ–¥ –∏—Å—á–µ—Ä–ø–∞–Ω" };
     
     // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     const userUses = await PromoUse.countDocuments({ promo: promo._id, user: user._id });
     if (userUses >= promo.maxUsesPerUser) {
       return { valid: false, error: "–í—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —ç—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥" };
     }
     
     // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞
     if (order.totalAmount < promo.constraints.minOrderAmount) {
       return { valid: false, error: `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ ${promo.constraints.minOrderAmount}‚ÇΩ` };
     }
     
     // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
     if (promo.constraints.applicableCategories?.length > 0) {
       const hasApplicableItems = order.items.some(item => 
         promo.constraints.applicableCategories.includes(item.product.category)
       );
       if (!hasApplicableItems) {
         return { valid: false, error: "–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º –∫ —Ç–æ–≤–∞—Ä–∞–º –≤ –∫–æ—Ä–∑–∏–Ω–µ" };
       }
     }
     
     // –°–µ–≥–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     if (promo.constraints.userSegments?.includes("NEW_USERS")) {
       const orderCount = await Order.countDocuments({ customer: user._id, status: "DELIVERED" });
       if (orderCount > 0) {
         return { valid: false, error: "–ü—Ä–æ–º–æ–∫–æ–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π" };
       }
     }
     
     return { valid: true, promo };
   }
   ```
4. **–ï—Å–ª–∏ –≤–∞–ª–∏–¥–µ–Ω:**
   - –†–∞—Å—á—ë—Ç —Å–∫–∏–¥–∫–∏:
     ```typescript
     function calculateDiscount(promo: PromoCode, order: Order): number {
       switch (promo.type) {
         case "DISCOUNT_FIXED":
           return Math.min(promo.value, order.totalAmount);
         case "DISCOUNT_PERCENT":
           return (order.totalAmount * promo.value) / 100;
         case "FREE_DELIVERY":
           return order.deliveryFee;
         default:
           return 0;
       }
     }
     ```
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞:
     ```typescript
     {
       subtotal: 2500,
       discount: -500,       // –ü—Ä–æ–º–æ–∫–æ–¥ FRUIT2024
       deliveryFee: 200,
       total: 2200
     }
     ```
5. –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:
   - –°–æ–∑–¥–∞—ë—Ç—Å—è `PromoUse`:
     ```typescript
     {
       promo: promoId,
       user: userId,
       order: orderId,
       discountAmount: 500,
       usedAt: new Date()
     }
     ```
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞:
     ```typescript
     promo.currentUses += 1;
     promo.stats.totalDiscount += 500;
     promo.stats.totalRevenue += 2200;
     promo.stats.uniqueUsers = new Set([...users, userId]).size;
     ```

**API:** `POST /customer/cart/apply-promo-code`

### –ü—Ä–∏–º–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

```
–ö–æ—Ä–∑–∏–Ω–∞
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–§—Ä—É–∫—Ç—ã (2–∫–≥)        1000‚ÇΩ
–Ø–≥–æ–¥—ã (1–∫–≥)         1500‚ÇΩ
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–°—É–º–º–∞:              2500‚ÇΩ
–ü—Ä–æ–º–æ–∫–æ–¥ FRUIT2024:  -500‚ÇΩ
–î–æ—Å—Ç–∞–≤–∫–∞:            200‚ÇΩ
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û:              2200‚ÇΩ
```

---

## 3. –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ü–∏–∏ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é

**–ê–∫—Ç–æ—Ä:** PlatformStaff / Seller (–¥–ª—è —Å–≤–æ–∏—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤)

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –ê–¥–º–∏–Ω ‚Üí "–ê–∫—Ü–∏–∏" ‚Üí "–°–æ–∑–¥–∞—Ç—å –∞–∫—Ü–∏—é"
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
   ```typescript
   {
     name: "–ß—ë—Ä–Ω–∞—è –ø—è—Ç–Ω–∏—Ü–∞ 2024",
     type: "CATEGORY_DISCOUNT",
     
     discount: {
       type: "PERCENT",
       value: 25            // 25% —Å–∫–∏–¥–∫–∞
     },
     
     target: {
       categories: ["–§—Ä—É–∫—Ç—ã", "–û–≤–æ—â–∏"],
       shops: [],           // –ü—É—Å—Ç–æ = –≤—Å–µ –º–∞–≥–∞–∑–∏–Ω—ã
       minPrice: 500        // –¢–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –æ—Ç 500‚ÇΩ
     },
     
     schedule: {
       startDate: "2024-11-29 00:00",
       endDate: "2024-12-01 23:59"
     },
     
     visibility: {
       showBadge: true,     // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –±–µ–π–¥–∂ "–ê–ö–¶–ò–Ø"
       featured: true,      // –í —Ç–æ–ø–µ –∫–∞—Ç–∞–ª–æ–≥–∞
       notifyUsers: true    // –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
     },
     
     status: "SCHEDULED"
   }
   ```
3. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `startDate`:
   - –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∞–∫—Ü–∏—é ‚Üí `status = "ACTIVE"`
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å–∫–∏–¥–∫–∏ –∫ —Ç–æ–≤–∞—Ä–∞–º:
     ```typescript
     for (const product of affectedProducts) {
       product.priceWithDiscount = product.price * 0.75;  // -25%
       product.badges.push("SALE");
     }
     ```
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–µ—Å–ª–∏ `notifyUsers = true`)
4. –í –∫–∞—Ç–∞–ª–æ–≥–µ —Ç–æ–≤–∞—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å–æ —Å–∫–∏–¥–∫–æ–π:
   ```
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ [–ê–ö–¶–ò–Ø -25%]        ‚îÇ
   ‚îÇ                     ‚îÇ
   ‚îÇ –Ø–±–ª–æ–∫–∏ –ì–æ–ª–¥–µ–Ω       ‚îÇ
   ‚îÇ ~~400‚ÇΩ~~ ‚Üí 300‚ÇΩ    ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ```

**API:** `POST /platform/campaigns`

---

## 4. –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

**–ê–∫—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è)

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   ```typescript
   // –ü—Ä–∏–º–µ—Ä: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∞—Å—Ç–æ –ø–æ–∫—É–ø–∞–µ—Ç —è–±–ª–æ–∫–∏
   const userBehavior = {
     favoriteCategories: ["–§—Ä—É–∫—Ç—ã"],
     topProducts: ["–Ø–±–ª–æ–∫–∏", "–ì—Ä—É—à–∏"],
     avgOrderAmount: 2000,
     daysSinceLastOrder: 14
   };
   ```
2. –ù–∞ –æ—Å–Ω–æ–≤–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:
   ```typescript
   // –¢—Ä–∏–≥–≥–µ—Ä—ã
   if (userBehavior.daysSinceLastOrder > 30) {
     // Win-back: –≤–µ—Ä–Ω—É—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
     createPersonalOffer({
       user: userId,
       type: "WIN_BACK",
       discount: 20,  // 20% —Å–∫–∏–¥–∫–∞
       message: "–ú—ã —Å–∫—É—á–∞–ª–∏! –í–æ—Ç 20% —Å–∫–∏–¥–∫–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–∫–∞–∑",
       validDays: 7
     });
   }
   
   if (userBehavior.favoriteCategories.includes("–§—Ä—É–∫—Ç—ã")) {
     // Upsell: –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã
     createPersonalOffer({
       user: userId,
       type: "UPSELL",
       products: relatedProducts,
       discount: 10,
       message: "–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—Å: 10% –Ω–∞ —è–≥–æ–¥—ã –∫ –≤–∞—à–∏–º –ª—é–±–∏–º—ã–º —Ñ—Ä—É–∫—Ç–∞–º"
     });
   }
   ```
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:
   - Push: "üéÅ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!"
   - Telegram: "–ú—ã —Å–∫—É—á–∞–ª–∏! –í–æ—Ç 20% —Å–∫–∏–¥–∫–∞..."
4. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ "–ú–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è"
5. –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –∑–∞–∫–∞–∑—É

**API:** `GET /customer/personal-offers`

### –°–µ–≥–º–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

| –°–µ–≥–º–µ–Ω—Ç | –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç—Ä–∞—Ç–µ–≥–∏—è |
|---------|----------|-----------|
| `NEW_USERS` | 0 –∑–∞–∫–∞–∑–æ–≤ | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–∫–∏–¥–∫–∞ 15% |
| `ACTIVE` | >3 –∑–∞–∫–∞–∑–æ–≤/–º–µ—Å—è—Ü | –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –∞–∫—Ü–∏–∏ |
| `CHURNING` | –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ 30+ –¥–Ω–µ–π | Win-back —Å–∫–∏–¥–∫–∞ 20% |
| `VIP` | >10 –∑–∞–∫–∞–∑–æ–≤ –∏–ª–∏ tier GOLD | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã |
| `CART_ABANDONED` | –û—Å—Ç–∞–≤–∏–ª —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω–µ | –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ + 10% —Å–∫–∏–¥–∫–∞ |

---

## 5. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

**–ê–∫—Ç–æ—Ä:** Customer (—Ä–µ—Ñ–µ—Ä–µ—Ä) ‚Üí Customer (—Ä–µ—Ñ–µ—Ä–∞–ª)

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. **–†–µ—Ñ–µ—Ä–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥:**
   ```typescript
   {
     referralCode: "IVAN2024",
     user: userId,
     stats: {
       totalReferrals: 0,
       successfulOrders: 0,
       totalBonus: 0
     }
   }
   ```
2. –†–µ—Ñ–µ—Ä–µ—Ä –¥–µ–ª–∏—Ç—Å—è –∫–æ–¥–æ–º —Å –¥—Ä—É–≥–æ–º
3. **–î—Ä—É–≥ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —Å –∫–æ–¥–æ–º:**
   ```typescript
   // –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   {
     phone: "+77001234567",
     referralCode: "IVAN2024"  // –í–≤—ë–ª –∫–æ–¥ –¥—Ä—É–≥–∞
   }
   ```
4. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç —Å–≤—è–∑—å:
   ```typescript
   {
     referrer: referrerId,
     referee: newUserId,
     status: "PENDING",
     createdAt: new Date()
   }
   ```
5. **–î—Ä—É–≥ –¥–µ–ª–∞–µ—Ç –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑:**
   - –ü–æ–ª—É—á–∞–µ—Ç —Å–∫–∏–¥–∫—É 500‚ÇΩ
   - –ü–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏ (`DELIVERED`):
     ```typescript
     referral.status = "COMPLETED";
     
     // –ë–æ–Ω—É—Å—ã —Ä–µ—Ñ–µ—Ä—É
     await loyaltyService.addPoints({
       user: referrerId,
       amount: 300,
       reason: "REFERRAL_BONUS",
       metadata: { refereeId: newUserId }
     });
     
     // –ë–æ–Ω—É—Å—ã —Ä–µ—Ñ–µ—Ä–∞–ª—É
     await loyaltyService.addPoints({
       user: newUserId,
       amount: 200,
       reason: "REGISTRATION_WITH_REFERRAL"
     });
     ```
6. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
   - –†–µ—Ñ–µ—Ä—É: "–í–∞—à –¥—Ä—É–≥ —Å–¥–µ–ª–∞–ª –∑–∞–∫–∞–∑! +300 –±–∞–ª–ª–æ–≤"
   - –†–µ—Ñ–µ—Ä–∞–ª—É: "+200 –±–∞–ª–ª–æ–≤ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é"

**API:** 
- `GET /customer/referral-code` - –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π –∫–æ–¥
- `GET /customer/referral-stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

### –£—Å–ª–æ–≤–∏—è

| –î–µ–π—Å—Ç–≤–∏–µ | –ë–æ–Ω—É—Å —Ä–µ—Ñ–µ—Ä—É | –ë–æ–Ω—É—Å —Ä–µ—Ñ–µ—Ä–∞–ª—É |
|----------|--------------|----------------|
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | - | - |
| –ü–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ | +300 –±–∞–ª–ª–æ–≤ | 500‚ÇΩ —Å–∫–∏–¥–∫–∞ + 200 –±–∞–ª–ª–æ–≤ |
| –ö–∞–∂–¥—ã–π 5-–π –∑–∞–∫–∞–∑ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ | +100 –±–∞–ª–ª–æ–≤ | - |

---

## 6. Flash-sale (–º–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–∞—è —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞)

**–ê–∫—Ç–æ—Ä:** PlatformStaff

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –ê–¥–º–∏–Ω —Å–æ–∑–¥–∞—ë—Ç flash-sale:
   ```typescript
   {
     name: "–ß–∞—Å —è–±–ª–æ–∫!",
     products: [
       { product: appleProductId, discountPrice: 199, originalPrice: 299, stock: 100 }
     ],
     startTime: "2024-12-05 18:00",
     duration: 60,  // 60 –º–∏–Ω—É—Ç
     maxPerUser: 3,  // –ú–∞–∫—Å. 3 —É–ø–∞–∫–æ–≤–∫–∏ –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞
     notifyInAdvance: 30  // –£–≤–µ–¥–æ–º–∏—Ç—å –∑–∞ 30 –º–∏–Ω—É—Ç
   }
   ```
2. –ó–∞ 30 –º–∏–Ω—É—Ç –¥–æ –Ω–∞—á–∞–ª–∞:
   - Push –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º: "‚ö° –ß–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç: –ß–∞—Å —è–±–ª–æ–∫! –°–∫–∏–¥–∫–∞ 33%"
3. –í 18:00 –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è:
   - –¢–æ–≤–∞—Ä –ø–æ–º–µ—á–∞–µ—Ç—Å—è `flash-sale: true`
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞
   - –°—á—ë—Ç—á–∏–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –µ–¥–∏–Ω–∏—Ü
   ```
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ ‚ö° FLASH SALE             ‚îÇ
   ‚îÇ –û—Å—Ç–∞–ª–æ—Å—å: 00:45:12       ‚îÇ
   ‚îÇ                          ‚îÇ
   ‚îÇ –Ø–±–ª–æ–∫–∏                   ‚îÇ
   ‚îÇ ~~299‚ÇΩ~~ ‚Üí 199‚ÇΩ         ‚îÇ
   ‚îÇ                          ‚îÇ
   ‚îÇ –í –Ω–∞–ª–∏—á–∏–∏: 47 —à—Ç         ‚îÇ
   ‚îÇ [–ö—É–ø–∏—Ç—å] (–º–∞–∫—Å. 3)       ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ```
4. –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ stock –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
   - –ë—ã—Å—Ç—Ä–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏)
5. –ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ (18:60) –∏–ª–∏ –∫–æ–≥–¥–∞ stock = 0:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
     ```typescript
     {
       totalSold: 100,
       totalRevenue: 19900,
       avgPurchaseTime: "2 –º–∏–Ω—É—Ç—ã",
       uniqueBuyers: 35
     }
     ```

**API:** `POST /platform/flash-sales`

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–≤–æ–¥–∫–∞

### –°—É—â–Ω–æ—Å—Ç—å PromoCode

```typescript
{
  code: string,              // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥
  type: "DISCOUNT_FIXED" | "DISCOUNT_PERCENT" | "FREE_DELIVERY" | "CASHBACK_BONUS",
  value: number,
  
  constraints: {
    minOrderAmount?: number,
    maxUses?: number,
    maxUsesPerUser?: number,
    validFrom: Date,
    validUntil: Date,
    applicableCategories?: string[],
    excludedProducts?: ObjectId[],
    userSegments?: string[],
    cities?: string[]
  },
  
  budget: {
    total: number,
    perUser: number,
    spent: number
  },
  
  stats: {
    totalUses: number,
    totalDiscount: number,
    totalRevenue: number,
    uniqueUsers: number,
    conversionRate: number
  },
  
  status: "DRAFT" | "SCHEDULED" | "ACTIVE" | "PAUSED" | "EXPIRED",
  createdBy: ObjectId,
  createdAt: Date
}
```

### –°—É—â–Ω–æ—Å—Ç—å Campaign (–∞–∫—Ü–∏—è)

```typescript
{
  name: string,
  type: "CATEGORY_DISCOUNT" | "PRODUCT_BUNDLE" | "FLASH_SALE",
  
  discount: {
    type: "FIXED" | "PERCENT",
    value: number
  },
  
  target: {
    categories?: string[],
    products?: ObjectId[],
    shops?: ObjectId[],
    minPrice?: number
  },
  
  schedule: {
    startDate: Date,
    endDate: Date
  },
  
  visibility: {
    showBadge: boolean,
    featured: boolean,
    notifyUsers: boolean
  },
  
  stats: {
    views: number,
    clicks: number,
    orders: number,
    revenue: number,
    roi: number
  },
  
  status: "DRAFT" | "SCHEDULED" | "ACTIVE" | "COMPLETED" | "CANCELLED"
}
```

### –°—É—â–Ω–æ—Å—Ç—å PersonalOffer

```typescript
{
  user: ObjectId,
  type: "WIN_BACK" | "UPSELL" | "CROSS_SELL" | "BIRTHDAY" | "MILESTONE",
  
  discount: {
    type: "FIXED" | "PERCENT",
    value: number
  },
  
  conditions: {
    minOrderAmount?: number,
    products?: ObjectId[],
    categories?: string[]
  },
  
  message: string,
  validUntil: Date,
  
  status: "ACTIVE" | "USED" | "EXPIRED",
  usedAt?: Date,
  order?: ObjectId
}
```

### API

**Customer:**
- `POST /customer/cart/apply-promo-code` - –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
- `GET /customer/personal-offers` - –º–æ–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- `GET /customer/referral-code` - –º–æ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
- `GET /customer/referral-stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- `GET /campaigns/active` - –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–∫—Ü–∏–∏

**Seller:**
- `POST /seller/campaigns` - —Å–æ–∑–¥–∞—Ç—å –∞–∫—Ü–∏—é –¥–ª—è —Å–≤–æ–∏—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤
- `GET /seller/campaigns/analytics` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∞–∫—Ü–∏–π

**Platform:**
- `POST /platform/promo-codes` - —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
- `PATCH /platform/promo-codes/:id` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- `GET /platform/promo-codes/:id/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `POST /platform/campaigns` - —Å–æ–∑–¥–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é –∞–∫—Ü–∏—é
- `POST /platform/flash-sales` - —Å–æ–∑–¥–∞—Ç—å flash-sale
- `GET /platform/marketing/analytics` - –æ–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞

### –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞

1. **–û–¥–∏–Ω –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ –∑–∞–∫–∞–∑** (–ø—Ä–æ–º–æ–∫–æ–¥—ã –Ω–µ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è)
2. **–ê–∫—Ü–∏–∏ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è** —Å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏
3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞:** 1‚ÇΩ
4. **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞:** 90% –æ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞
5. **–ë—é–¥–∂–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
6. **–ò—Å—Ç—ë–∫—à–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è (cron)
7. **Flash-sale –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç** –Ω–∞–¥ –æ–±—ã—á–Ω—ã–º–∏ –∞–∫—Ü–∏—è–º–∏
8. **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è** –¥–µ–π—Å—Ç–≤—É—é—Ç 7 –¥–Ω–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
9. **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å** –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ `DELIVERED`
10. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## –ü—Ä–∏–º–µ—Ä—ã

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```typescript
await promoService.create({
  code: "WELCOME2024",
  type: "DISCOUNT_FIXED",
  value: 500,
  constraints: {
    minOrderAmount: 1000,
    maxUses: 10000,
    maxUsesPerUser: 1,
    validFrom: new Date("2024-12-01"),
    validUntil: new Date("2024-12-31"),
    userSegments: ["NEW_USERS"]
  },
  budget: {
    total: 5000000,  // 5 –º–ª–Ω ‚ÇΩ
    perUser: 500
  }
});
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞

```typescript
const result = await cartService.applyPromoCode({
  userId,
  code: "WELCOME2024"
});

if (result.success) {
  // { discount: 500, newTotal: 1500 }
  console.log(`–°–∫–∏–¥–∫–∞: ${result.discount}‚ÇΩ`);
} else {
  // { error: "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ 1000‚ÇΩ" }
  console.error(result.error);
}
```

---

## –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

**Order Flow:**
- –ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ –∞–∫—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
- –°–∫–∏–¥–∫–∏ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—É–º–º–µ

**Loyalty Flow:**
- –ö—ç—à–±–µ–∫ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Å —É—á—ë—Ç–æ–º —Å–∫–∏–¥–æ–∫
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã –∏–¥—É—Ç –≤ –±–∞–ª–ª—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**Analytics Flow:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–º–ø–∞–Ω–∏–π
- ROI –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

**Notification Flow:**
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∞–∫—Ü–∏—è—Ö –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –ø—Ä–æ–º–æ–∫–æ–¥–∞—Ö

---

> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤  
> **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2024-11-24
