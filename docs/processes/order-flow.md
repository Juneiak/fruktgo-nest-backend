# –ü—Ä–æ—Ü–µ—Å—Å: –ó–∞–∫–∞–∑ (Order Flow)

> **–£—á–∞—Å—Ç–Ω–∏–∫–∏:** Customer, Shop, Employee, PlatformStaff  
> **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è ~30-90 –º–∏–Ω—É—Ç  
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞, –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤, –û–ø–ª–∞—Ç–∞

---

## –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

–ö–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ **–∫–æ—Ä–∑–∏–Ω—É**, –æ—Ñ–æ—Ä–º–ª—è–µ—Ç **–∑–∞–∫–∞–∑**, –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –æ–Ω–ª–∞–π–Ω. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –º–∞–≥–∞–∑–∏–Ω–∞ **—Å–æ–±–∏—Ä–∞–µ—Ç** –∑–∞–∫–∞–∑, –∫—É—Ä—å–µ—Ä **–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç**. –ü–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–µ–Ω—å–≥–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è: –º–∞–≥–∞–∑–∏–Ω—É –≤—ã—Ä—É—á–∫–∞, –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –∫–æ–º–∏—Å—Å–∏—è.

**–í–µ—Å—å —Ü–∏–∫–ª:** –∫–æ—Ä–∑–∏–Ω–∞ ‚Üí –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ ‚Üí –æ–ø–ª–∞—Ç–∞ ‚Üí —Å–±–æ—Ä–∫–∞ ‚Üí –¥–æ—Å—Ç–∞–≤–∫–∞ ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ ‚Üí —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã.

### –ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞

**–§–∏–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
- –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–æ–≤ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è (–Ω–µ –º–µ–Ω—è—é—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–¥–∞–≤–µ—Ü –∏–∑–º–µ–Ω–∏—Ç —Ü–µ–Ω—É –≤ –∫–∞—Ç–∞–ª–æ–≥–µ)
- –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –≤ `OrderItem[]` –∏ –±–æ–ª—å—à–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è
- –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –∏ –∫–ª–∏–µ–Ω—Ç–∞ (—Ü–µ–Ω–∞ –Ω–µ –≤—ã—Ä–∞—Å—Ç–µ—Ç), –∏ –º–∞–≥–∞–∑–∏–Ω (—Ü–µ–Ω–∞ –Ω–µ —É–ø–∞–¥—ë—Ç)

**–°–±–æ—Ä–∫–∞ –∏ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ:**
- –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–≤–∞—Ä, –≤–∑–≤–µ—à–∏–≤–∞–µ—Ç –≤–µ—Å–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- –ï—Å–ª–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—Å –º–µ–Ω—å—à–µ –∑–∞–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ tolerance ‚Äî –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é –±–∞–ª–ª–∞–º–∏
- –ï—Å–ª–∏ –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ tolerance ‚Äî –ø–µ—Ä–µ–≤–µ—Å –∑–∞ —Å—á—ë—Ç –º–∞–≥–∞–∑–∏–Ω–∞ (–∫–ª–∏–µ–Ω—Ç –Ω–µ –¥–æ–ø–ª–∞—á–∏–≤–∞–µ—Ç)

**–û–¥–∏–Ω –∑–∞–∫–∞–∑ = –æ–¥–∏–Ω –º–∞–≥–∞–∑–∏–Ω:**
- –ù–µ–ª—å–∑—è –∑–∞–∫–∞–∑–∞—Ç—å –∏–∑ —Ä–∞–∑–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ –≤ –æ–¥–Ω–æ–º –∑–∞–∫–∞–∑–µ
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–∫–∞–∑

**–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã:**
- –ü–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `SettlementPeriod` –º–∞–≥–∞–∑–∏–Ω–∞
- –î–µ–Ω—å–≥–∏ –∞–∫–∫—É–º—É–ª–∏—Ä—É—é—Ç—Å—è, –∫–æ–º–∏—Å—Å–∏—è —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- –í—ã–ø–ª–∞—Ç–∞ –ø—Ä–æ–¥–∞–≤—Ü—É —Ä–∞–∑ –≤ 2-3 –Ω–µ–¥–µ–ª–∏ –ø–æ –∑–∞–∫—Ä—ã—Ç–∏—é –ø–µ—Ä–∏–æ–¥–∞

### –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞

`DRAFT` ‚Üí `PENDING_PAYMENT` ‚Üí `PAID` ‚Üí `ACCEPTED` ‚Üí `IN_ASSEMBLY` ‚Üí `READY_FOR_DELIVERY` ‚Üí `IN_DELIVERY` ‚Üí `DELIVERED`

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ: `CANCELLED` (–æ—Ç–º–µ–Ω—ë–Ω –∫–ª–∏–µ–Ω—Ç–æ–º/–º–∞–≥–∞–∑–∏–Ω–æ–º), `FAILED` (–Ω–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω)

---

## 1. –û–±–∑–æ—Ä

–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–∫–∞–∑–∞ –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω—É –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤.

**–¶–µ–ª—å:** –û–±–µ—Å–ø–µ—á–∏—Ç—å –±—ã—Å—Ç—Ä—É—é –¥–æ—Å—Ç–∞–≤–∫—É —Å–≤–µ–∂–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –∫–∞—á–µ—Å—Ç–≤–∞.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–∫–∞–∑
- –ú–∞–≥–∞–∑–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç –≤—ã—Ä—É—á–∫—É (–∑–∞ –≤—ã—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–∏)
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é

---

## 2. –í—Ö–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è

- ‚úÖ –ö–ª–∏–µ–Ω—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (`Customer` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- ‚úÖ –í—ã–±—Ä–∞–Ω –º–∞–≥–∞–∑–∏–Ω (`Shop` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `OPENED`)
- ‚úÖ –ú–∞–≥–∞–∑–∏–Ω –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω (`verifiedStatus = VERIFIED`)
- ‚úÖ –ï—Å—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏ (`ShopProduct` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `ACTIVE`, `stockQuantity > 0`)
- ‚úÖ –£ –º–∞–≥–∞–∑–∏–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞ —Å–º–µ–Ω–∞ (`Shift` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `OPEN`)

---

## 3. –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π (Happy Path)

### –®–∞–≥ 1: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã

**–ê–∫—Ç–æ—Ä:** Customer

1. –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ –º–∞–≥–∞–∑–∏–Ω–∞ (`GET /public/shop-products?shopId=...`)
2. –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
3. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç `Cart`:
   - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–Ω–æ `product.stepRate`)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (`shopProduct.stockQuantity >= quantity`)
   - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—â—É—é —Å—É–º–º—É

**–°—É—â–Ω–æ—Å—Ç–∏:** `Cart`, `CartProduct`  
**API:** 
- `POST /customer/cart/items` - –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
- `PATCH /customer/cart/items/:productId` - –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- `GET /customer/cart` - –ø–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É

**–í–∞–ª–∏–¥–∞—Ü–∏–∏:**
- `quantity % stepRate === 0`
- `quantity <= stockQuantity`
- `cart.totalSum >= shop.minOrderSum`

---

### –®–∞–≥ 2: –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞

**–ê–∫—Ç–æ—Ä:** Customer

1. –ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é (`POST /customer/orders/checkout`)
2. –í—ã–±–∏—Ä–∞–µ—Ç:
   - –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ (–∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∏–ª–∏ –Ω–æ–≤—ã–π)
   - –°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è (–¥–æ—Å—Ç–∞–≤–∫–∞/—Å–∞–º–æ–≤—ã–≤–æ–∑)
   - –ü—Ä–æ–º–æ–∫–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç —á–µ—Ä–Ω–æ–≤–∏–∫ `Order`:
   - –°—Ç–∞—Ç—É—Å: `DRAFT`
   - –§–∏–∫—Å–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–∞–≤ –∫–æ—Ä–∑–∏–Ω—ã –≤ `OrderItem[]`
   - –§–∏–∫—Å–∏—Ä—É–µ—Ç —Ü–µ–Ω—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É
4. –ü—Ä–æ–≤–µ—Ä–∫–∏:
   - –ó–æ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ (–µ—Å–ª–∏ –¥–æ—Å—Ç–∞–≤–∫–∞)
   - –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞

**–°—É—â–Ω–æ—Å—Ç–∏:** `Order`, `OrderItem`, `Address`  
**API:** `POST /customer/orders/checkout`

**–ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞:**
- –¶–µ–Ω—ã —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–Ω–µ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –ø–æ—Å–ª–µ)
- –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è (–Ω–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã)

---

### –®–∞–≥ 3: –û–ø–ª–∞—Ç–∞

**–ê–∫—Ç–æ—Ä:** Customer + Payment Provider

1. –ö–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –æ–ø–ª–∞—Ç—É (`POST /customer/orders/:orderId/pay`)
2. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç `Payment`:
   - –°—Ç–∞—Ç—É—Å: `INITIATED`
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É (–ÆKassa)
3. –ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –ø–ª–∞—Ç—ë–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
4. –ü–ª–∞—Ç—ë–∂–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–ø–ª–∞—Ç—É
5. Webhook –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (`POST /webhooks/payment`)
6. –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç:
   - `Payment.status = SUCCESS`
   - `Order.status = PAID`
   - –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã (—É–º–µ–Ω—å—à–∞–µ—Ç `shopProduct.stockQuantity`)

**–°—É—â–Ω–æ—Å—Ç–∏:** `Payment`  
**API:** 
- `POST /customer/orders/:orderId/pay`
- `POST /webhooks/payment` (callback)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ï—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞ ‚Üí —Å–º. —Ä–∞–∑–¥–µ–ª 4.1

---

### –®–∞–≥ 4: –°–±–æ—Ä–∫–∞ –∑–∞–∫–∞–∑–∞

**–ê–∫—Ç–æ—Ä:** Employee (—Å–±–æ—Ä—â–∏–∫)

1. –ó–∞–∫–∞–∑ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –ø–∞–Ω–µ–ª–∏ –º–∞–≥–∞–∑–∏–Ω–∞ (`GET /shop/orders?status=PAID`)
2. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –±–µ—Ä—ë—Ç –∑–∞–∫–∞–∑ –≤ —Ä–∞–±–æ—Ç—É:
   - –°–æ–∑–¥–∞—ë—Ç—Å—è `Task` (type: `PICKING`)
   - `Order.status = IN_PROGRESS`
3. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã:
   - –û—Ç–º–µ—á–∞–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
   - –î–ª—è –≤–µ—Å–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—Å
   - –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞ –æ—Ç–º–µ—á–∞–µ—Ç –∑–∞–º–µ–Ω—É/–æ—Ç–º–µ–Ω—É –ø–æ–∑–∏—Ü–∏–∏
4. –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Å–±–æ—Ä–∫—É:
   - `Task.status = COMPLETED`
   - `Order.status = READY_FOR_DELIVERY` (–∏–ª–∏ `READY_FOR_PICKUP`)
   - –°–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –æ—Å—Ç–∞—Ç–∫–∏ —Å–æ —Å–∫–ª–∞–¥–∞

**–°—É—â–Ω–æ—Å—Ç–∏:** `Task`, `Shift`  
**API:** 
- `GET /shop/orders`
- `PATCH /shop/orders/:orderId/pick`
- `POST /shop/orders/:orderId/complete-picking`

**–ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞:**
- –°–±–æ—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö `shop.assemblyTimeLimit`
- –ü—Ä–∏ –Ω–µ–¥–æ–≤–µ—Å–µ: —Ä–∞–∑–Ω–∏—Ü–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É –±–∞–ª–ª–∞–º–∏
- –ü—Ä–∏ –ø–µ—Ä–µ–≤–µ—Å–µ: –∫–ª–∏–µ–Ω—Ç –Ω–µ –¥–æ–ø–ª–∞—á–∏–≤–∞–µ—Ç (–∑–∞ —Å—á—ë—Ç –º–∞–≥–∞–∑–∏–Ω–∞)

---

### –®–∞–≥ 5: –î–æ—Å—Ç–∞–≤–∫–∞/—Å–∞–º–æ–≤—ã–≤–æ–∑

#### –í–∞—Ä–∏–∞–Ω—Ç A: –î–æ—Å—Ç–∞–≤–∫–∞

**–ê–∫—Ç–æ—Ä:** Employee (–∫—É—Ä—å–µ—Ä)

1. –°–æ–∑–¥–∞—ë—Ç—Å—è `Task` (type: `DELIVERY`)
2. –ö—É—Ä—å–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É
3. –î–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç—É
4. –û—Ç–º–µ—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å:
   - `Order.status = DELIVERED` (—É—Å–ø–µ—à–Ω–æ)
   - `Order.status = DELIVERY_FAILED` (–Ω–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)

#### –í–∞—Ä–∏–∞–Ω—Ç B: –°–∞–º–æ–≤—ã–≤–æ–∑

**–ê–∫—Ç–æ—Ä:** Employee (–∫–∞—Å—Å–∏—Ä/–≤—ã–¥–∞—á–∞)

1. –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –º–∞–≥–∞–∑–∏–Ω
2. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (QR/–∫–æ–¥/—Ç–µ–ª–µ—Ñ–æ–Ω)
3. –í—ã–¥–∞—ë—Ç –∑–∞–∫–∞–∑
4. –û—Ç–º–µ—á–∞–µ—Ç: `Order.status = DELIVERED`

**–°—É—â–Ω–æ—Å—Ç–∏:** `Task`  
**API:** 
- `POST /shop/orders/:orderId/deliver`
- `POST /shop/orders/:orderId/pickup`

---

### –®–∞–≥ 6: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ —Ñ–∏–Ω–∞–Ω—Å—ã

**–ê–∫—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

1. –ü–æ—Å–ª–µ `Order.status = DELIVERED`:
   - –°–æ–∑–¥–∞—ë—Ç—Å—è `SettlementTransaction` –¥–ª—è `SettlementPeriod`
   - –§–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤—ã—Ä—É—á–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–º–∏—Å—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (—Å —É—á—ë—Ç–æ–º –¥–∏–Ω–∞–º–∏–∫–∏)
2. –ö–ª–∏–µ–Ω—Ç—É –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –æ—Ü–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑/–º–∞–≥–∞–∑–∏–Ω
3. –í –∫–æ–Ω—Ü–µ —Ä–∞—Å—á—ë—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞:
   - –î–µ–Ω—å–≥–∏ –∞–∫–∫—É–º—É–ª–∏—Ä—É—é—Ç—Å—è –≤ `SellerAccount`
   - –°–æ–∑–¥–∞—ë—Ç—Å—è `Payout` –¥–ª—è –≤—ã–ø–ª–∞—Ç—ã

**–°—É—â–Ω–æ—Å—Ç–∏:** `SettlementPeriod`, `SettlementTransaction`, `Payout`

---

## 4. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 4.1. –û–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞

- **–ö–æ–≥–¥–∞:** Payment Provider –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É
- **–î–µ–π—Å—Ç–≤–∏–µ:** 
  - `Payment.status = FAILED`
  - `Order.status = PAYMENT_FAILED`
  - –†–µ–∑–µ—Ä–≤ —Ç–æ–≤–∞—Ä–æ–≤ —Å–Ω–∏–º–∞–µ—Ç—Å—è
  - –ö–ª–∏–µ–Ω—Ç—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É

---

### 4.2. –¢–æ–≤–∞—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ —Å–±–æ—Ä–∫–µ

- **–ö–æ–≥–¥–∞:** `shopProduct.stockQuantity = 0` –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–±–æ—Ä–∫–∏
- **–î–µ–π—Å—Ç–≤–∏–µ:**
  - –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—Ç–º–µ—á–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∫–∞–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—É—é
  - –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—É–º–º—É –∑–∞–∫–∞–∑–∞
  - –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç `Refund`
  - –ö–ª–∏–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª—è–µ—Ç—Å—è

---

### 4.3. –ö–ª–∏–µ–Ω—Ç –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–∞–∑

- **–ö–æ–≥–¥–∞:** –î–æ –Ω–∞—á–∞–ª–∞ —Å–±–æ—Ä–∫–∏ (`status = PAID`)
- **–î–µ–π—Å—Ç–≤–∏–µ:**
  - `Order.status = CANCELED`
  - –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç `Refund`
  - –†–µ–∑–µ—Ä–≤ —Ç–æ–≤–∞—Ä–æ–≤ —Å–Ω–∏–º–∞–µ—Ç—Å—è

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ —Å–±–æ—Ä–∫–∏ –æ—Ç–º–µ–Ω–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É

---

### 4.4. –î–æ—Å—Ç–∞–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å

- **–ö–æ–≥–¥–∞:** –ö–ª–∏–µ–Ω—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, –Ω–µ–≤–µ—Ä–Ω—ã–π –∞–¥—Ä–µ—Å
- **–î–µ–π—Å—Ç–≤–∏–µ:**
  - `Order.status = DELIVERY_FAILED`
  - –°–æ–∑–¥–∞—ë—Ç—Å—è `SupportCase`
  - –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç

---

## 5. –í—ã—Ö–æ–¥–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–£—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**
- ‚úÖ `Order` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `DELIVERED`
- ‚úÖ –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª —Ç–æ–≤–∞—Ä—ã
- ‚úÖ `SettlementTransaction` —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –û—Å—Ç–∞—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤

**–ù–µ—É—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**
- ‚ùå `Order` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `CANCELED` / `PAYMENT_FAILED` / `DELIVERY_FAILED`
- ‚ùå `Refund` –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω (–µ—Å–ª–∏ –±—ã–ª–∞ –æ–ø–ª–∞—Ç–∞)
- ‚ùå `SupportCase` —Å–æ–∑–¥–∞–Ω (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞)

---

## 6. –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

1. **–û–¥–∏–Ω –∑–∞–∫–∞–∑ = –æ–¥–∏–Ω –º–∞–≥–∞–∑–∏–Ω** (–Ω–µ—Ç –º—É–ª—å—Ç–∏-–º–∞–≥–∞–∑–∏–Ω–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã –≤ MVP)
2. **–¶–µ–Ω—ã —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è** –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–Ω–µ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –ø–æ—Å–ª–µ)
3. **–û–ø–ª–∞—á–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è** (—Ç–æ–ª—å–∫–æ –æ—Ç–º–µ–Ω–∞/–≤–æ–∑–≤—Ä–∞—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç—É—Å—ã)
4. **–°–±–æ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è Employee** —Å –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω–æ–π, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º –∫ Shop
5. **–ü—Ä–∏ –Ω–µ–¥–æ–≤–µ—Å–µ:** –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –±–∞–ª–ª—ã
6. **–ü—Ä–∏ –ø–µ—Ä–µ–≤–µ—Å–µ:** –∫–ª–∏–µ–Ω—Ç –Ω–µ –¥–æ–ø–ª–∞—á–∏–≤–∞–µ—Ç (—É–±—ã—Ç–æ–∫ –º–∞–≥–∞–∑–∏–Ω–∞)
7. **–í–æ–∑–≤—Ä–∞—Ç—ã –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã:** —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `Refund` –∏ `SettlementTransaction`
8. **SLA –∫–æ–Ω—Ç—Ä–æ–ª—å:**
   - –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–∫–∞–∑–∞: `shop.acceptanceTimeLimit`
   - –°–±–æ—Ä–∫–∞ –∑–∞–∫–∞–∑–∞: `shop.assemblyTimeLimit`

---

## 7. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—É—â–Ω–æ—Å—Ç–∏:

**Order:**
```typescript
{
  _id, orderId,
  customer: Customer,
  shop: Shop,
  items: OrderItem[],
  status: OrderStatus,
  totalAmount: number,
  deliveryInfo: DeliveryInfo,
  payment: Payment,
  createdAt, updatedAt
}
```

**–°—Ç–∞—Ç—É—Å—ã Order:**
- `DRAFT` ‚Üí `PAID` ‚Üí `IN_PROGRESS` ‚Üí `READY_FOR_DELIVERY` ‚Üí `DELIVERED`
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã: `PAYMENT_FAILED`, `CANCELED`, `DELIVERY_FAILED`

### API endpoints:

| –†–æ–ª—å | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|----------|
| Customer | `POST /customer/cart/items` | –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É |
| Customer | `POST /customer/orders/checkout` | –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ |
| Customer | `POST /customer/orders/:id/pay` | –û–ø–ª–∞—Ç–∏—Ç—å |
| Customer | `GET /customer/orders/:id` | –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ |
| Shop | `GET /shop/orders` | –û—á–µ—Ä–µ–¥—å –∑–∞–∫–∞–∑–æ–≤ |
| Shop | `PATCH /shop/orders/:id/pick` | –í–∑—è—Ç—å –≤ —Å–±–æ—Ä–∫—É |
| Shop | `POST /shop/orders/:id/deliver` | –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ |
| Platform | `POST /webhooks/payment` | Webhook –æ–ø–ª–∞—Ç—ã |

### –°–æ–±—ã—Ç–∏—è:

- `OrderCreated`
- `PaymentCompleted`
- `OrderPickingStarted`
- `OrderReadyForDelivery`
- `OrderDelivered`
- `OrderCanceled`

---

## 8. –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

- **–û–ø–ª–∞—Ç–∞ (payment-flow.md):** –¥–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã —Å –ø–ª–∞—Ç—ë–∂–Ω—ã–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
- **–§–∏–Ω–∞–Ω—Å—ã (finance-flow.md):** —Ä–∞—Å—á—ë—Ç–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã –∏ –≤—ã–ø–ª–∞—Ç—ã
- **–°–∫–ª–∞–¥—Å–∫–æ–π —É—á—ë—Ç (inventory-flow.md):** —Å–ø–∏—Å–∞–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
- **–°–º–µ–Ω—ã (shift-flow.md):** –∫–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ (support-flow.md):** –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–±–ª–µ–º –∏ —Å–ø–æ—Ä–æ–≤

---

> **–°—Ç–∞—Ç—É—Å:** üìù –ß–µ—Ä–Ω–æ–≤–∏–∫  
> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024  
> **TODO:** –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—ã, –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç—ã