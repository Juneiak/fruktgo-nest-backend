# –ü—Ä–æ—Ü–µ—Å—Å: –î–æ—Å—Ç–∞–≤–∫–∞ –∏ –ª–æ–≥–∏—Å—Ç–∏–∫–∞

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** Customer, Courier, Shop, DeliveryService, LogisticsManager  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Order Module, Delivery Module, Geo Module, Routing Module

---

## –û–±–∑–æ—Ä

–î–µ—Ç–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–æ–π –∑–∞–∫–∞–∑–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –º–∞—Ä—à—Ä—É—Ç–æ–≤.

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫—É—Ä—å–µ—Ä–æ–≤
- Real-time –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ ETA (–≤—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è)
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è —Å—Ä–æ—á–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –¥–æ—Å—Ç–∞–≤–∫–∏

**–¢–∏–ø—ã –¥–æ—Å—Ç–∞–≤–∫–∏:**
- **–ö—É—Ä—å–µ—Ä—Å–∫–∞—è** - —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫—É—Ä—å–µ—Ä—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- **–°–∞–º–æ–≤—ã–≤–æ–∑** - –∫–ª–∏–µ–Ω—Ç –∑–∞–±–∏—Ä–∞–µ—Ç —Å–∞–º
- **–ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è** - —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–ª—É–∂–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏

**–ó–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏:**
- –û–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≥–µ–æ–ø–æ–ª–∏–≥–æ–Ω–∞–º–∏
- –†–∞–∑–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–æ–Ω
- –£—á—ë—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç–∏ –¥–æ—Ä–æ–≥

---

## 1. –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

**–ê–∫—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–∞ (–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞)

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –ö–ª–∏–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:
   ```typescript
   {
     address: "—É–ª. –ê–±–∞—è, 10, –∫–≤. 25",
     coordinates: {
       lat: 43.238949,
       lng: 76.889709
     },
     city: "–ê–ª–º–∞—Ç—ã"
   }
   ```

2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏:**
   ```typescript
   function getDeliveryZone(coordinates: Coordinates): DeliveryZone {
     for (const zone of deliveryZones) {
       if (isPointInPolygon(coordinates, zone.polygon)) {
         return zone;
       }
     }
     return null;  // –í–Ω–µ –∑–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏
   }
   
   const zone = getDeliveryZone(customerAddress);
   // { id: "zone_center", name: "–¶–µ–Ω—Ç—Ä", basePrice: 300, avgTime: 30 }
   ```

3. **–†–∞—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç –º–∞–≥–∞–∑–∏–Ω–∞:**
   ```typescript
   const distance = calculateDistance(
     shopAddress.coordinates,
     customerAddress.coordinates
   );
   // 5.2 –∫–º
   ```

4. **–†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏:**
   ```typescript
   function calculateDeliveryPrice(zone: DeliveryZone, distance: number, orderAmount: number): number {
     let price = zone.basePrice;  // 300‚ÇΩ
     
     // –ù–∞–¥–±–∞–≤–∫–∞ –∑–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (>3–∫–º)
     if (distance > 3) {
       price += (distance - 3) * 50;  // +50‚ÇΩ –∑–∞ –∫–∞–∂–¥—ã–π –∫–º
     }
     
     // –°–∫–∏–¥–∫–∞ –∑–∞ –∫—Ä—É–ø–Ω—ã–π –∑–∞–∫–∞–∑ (>3000‚ÇΩ)
     if (orderAmount > 3000) {
       price *= 0.5;  // 50% —Å–∫–∏–¥–∫–∞
     }
     
     // –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ >5000‚ÇΩ
     if (orderAmount > 5000) {
       price = 0;
     }
     
     return Math.round(price);
   }
   
   const deliveryPrice = calculateDeliveryPrice(zone, distance, 2500);
   // 410‚ÇΩ (300 + 2.2–∫–º * 50)
   ```

5. **–†–∞—Å—á—ë—Ç ETA (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–æ–µ –≤—Ä–µ–º—è):**
   ```typescript
   function calculateETA(distance: number, trafficFactor: number = 1.0): number {
     const avgSpeed = 30;  // –∫–º/—á –≤ –≥–æ—Ä–æ–¥–µ
     const baseTime = (distance / avgSpeed) * 60;  // –≤ –º–∏–Ω—É—Ç–∞—Ö
     const preparationTime = 20;  // –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –∑–∞–∫–∞–∑–∞
     
     return Math.round(preparationTime + (baseTime * trafficFactor));
   }
   
   const eta = calculateETA(5.2, 1.2);  // –° —É—á—ë—Ç–æ–º –ø—Ä–æ–±–æ–∫
   // 35 –º–∏–Ω—É—Ç
   ```

6. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É:
   ```
   –î–æ—Å—Ç–∞–≤–∫–∞
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   –ê–¥—Ä–µ—Å: —É–ª. –ê–±–∞—è, 10
   –ó–æ–Ω–∞: –¶–µ–Ω—Ç—Ä
   –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 5.2 –∫–º
   
   –°—Ç–æ–∏–º–æ—Å—Ç—å: 410‚ÇΩ
   –í—Ä–µ–º—è: ~35 –º–∏–Ω—É—Ç
   
   [ ] –û—Å—Ç–∞–≤–∏—Ç—å —É –¥–≤–µ—Ä–∏
   [ ] –ù–µ –∑–≤–æ–Ω–∏—Ç—å –≤ –¥–≤–µ—Ä—å
   ```

**API:** `POST /delivery/calculate`

### –ó–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏

| –ó–æ–Ω–∞ | –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ | –†–∞–¥–∏—É—Å | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è |
|------|--------------|--------|---------------|
| –¶–µ–Ω—Ç—Ä | 300‚ÇΩ | 0-3 –∫–º | 20-30 –º–∏–Ω |
| –°—Ä–µ–¥–Ω—è—è | 400‚ÇΩ | 3-7 –∫–º | 30-45 –º–∏–Ω |
| –î–∞–ª—å–Ω—è—è | 500‚ÇΩ | 7-15 –∫–º | 45-60 –º–∏–Ω |
| –ü—Ä–∏–≥–æ—Ä–æ–¥ | 800‚ÇΩ | 15-25 –∫–º | 60-90 –º–∏–Ω |

---

## 2. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫—É—Ä—å–µ—Ä–∞

**–ê–∫—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) –∏–ª–∏ LogisticsManager (–≤—Ä—É—á–Ω—É—é)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

1. –ó–∞–∫–∞–∑ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å `READY_FOR_DELIVERY`
2. –°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫—É—Ä—å–µ—Ä–æ–≤:
   ```typescript
   async function findAvailableCouriers(order: Order): Promise<Courier[]> {
     const couriers = await Courier.find({
       status: "AVAILABLE",
       onlineStatus: "ONLINE",
       currentOrders: { $lt: 3 },  // –ú–∞–∫—Å. 3 –∑–∞–∫–∞–∑–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
       "workZones": { $in: [order.deliveryZone] }
     });
     
     // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
     return couriers.sort((a, b) => {
       const scoreA = calculateCourierScore(a, order);
       const scoreB = calculateCourierScore(b, order);
       return scoreB - scoreA;
     });
   }
   ```

3. **–†–∞—Å—á—ë—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∫—É—Ä—å–µ—Ä–∞:**
   ```typescript
   function calculateCourierScore(courier: Courier, order: Order): number {
     let score = 100;
     
     // –ë–ª–∏–∑–æ—Å—Ç—å –∫ –º–∞–≥–∞–∑–∏–Ω—É (–≥–ª–∞–≤–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä)
     const distance = calculateDistance(courier.currentLocation, order.shop.address);
     score -= distance * 10;  // –®—Ç—Ä–∞—Ñ –∑–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
     
     // –†–µ–π—Ç–∏–Ω–≥ –∫—É—Ä—å–µ—Ä–∞
     score += courier.rating * 5;
     
     // –¢–µ–∫—É—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
     score -= courier.currentOrders.length * 15;
     
     // –£—Å–ø–µ—à–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–æ–∫ —Å–µ–≥–æ–¥–Ω—è
     score += courier.todayDeliveries * 2;
     
     return score;
   }
   ```

4. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ –∫—É—Ä—å–µ—Ä–∞:
   ```typescript
   const bestCourier = availableCouriers[0];
   
   order.courier = bestCourier._id;
   order.deliveryStatus = "COURIER_ASSIGNED";
   order.estimatedDeliveryTime = calculateETA(...);
   
   courier.currentOrders.push(order._id);
   courier.status = "BUSY";
   ```

5. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
   - –ö—É—Ä—å–µ—Ä—É: "–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ #12345! –ó–∞–±–µ—Ä–∏—Ç–µ –∏–∑ –§—Ä—É–∫—Ç–æ–≤–∞—è –±–∞–∑–∞"
   - –ö–ª–∏–µ–Ω—Ç—É: "–ö—É—Ä—å–µ—Ä –ò–≤–∞–Ω –ø—Ä–∏–Ω—è–ª –≤–∞—à –∑–∞–∫–∞–∑. ETA: 25 –º–∏–Ω—É—Ç"

**API:** `POST /delivery/assign-courier`

### –†—É—á–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–õ–æ–≥–∏—Å—Ç –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∫—É—Ä—å–µ—Ä–∞ –≤ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫—É—Ä—å–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
- –ò—Ö —Ç–µ–∫—É—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
- –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤

---

## 3. –ó–∞–±–æ—Ä –∑–∞–∫–∞–∑–∞ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞

**–ê–∫—Ç–æ—Ä:** Courier

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –ö—É—Ä—å–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –∑–∞–∫–∞–∑–µ
2. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏:
   ```
   –ó–∞–∫–∞–∑ #12345
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   –ú–∞–≥–∞–∑–∏–Ω: –§—Ä—É–∫—Ç–æ–≤–∞—è –±–∞–∑–∞
   üìç —É–ª. –¢–æ–ª–µ –±–∏, 45
   –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 1.2 –∫–º
   
   –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:
   ‚Ä¢ –Ø–±–ª–æ–∫–∏ 2–∫–≥
   ‚Ä¢ –ì—Ä—É—à–∏ 1.5–∫–≥
   ‚Ä¢ –ë–∞–Ω–∞–Ω—ã 1–∫–≥
   
   –°—É–º–º–∞: 2500‚ÇΩ (–æ–ø–ª–∞—á–µ–Ω–æ)
   
   –ö–ª–∏–µ–Ω—Ç: +7 700 123 45 67
   üìç —É–ª. –ê–±–∞—è, 10, –∫–≤. 25
   
   [–ù–∞—á–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É]
   ```

3. –ö—É—Ä—å–µ—Ä –µ–¥–µ—Ç –≤ –º–∞–≥–∞–∑–∏–Ω
4. **–ü—Ä–∏–±—ã—Ç–∏–µ –≤ –º–∞–≥–∞–∑–∏–Ω:**
   - –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ GPS, —á—Ç–æ –∫—É—Ä—å–µ—Ä –Ω–∞ –º–µ—Å—Ç–µ
   - –ö—É—Ä—å–µ—Ä ‚Üí "–Ø –Ω–∞ –º–µ—Å—Ç–µ"
   - –°—Ç–∞—Ç—É—Å: `COURIER_AT_SHOP`

5. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞:**
   - –ö—É—Ä—å–µ—Ä —Å–∫–∞–Ω–∏—Ä—É–µ—Ç QR-–∫–æ–¥ –∑–∞–∫–∞–∑–∞ –∏–ª–∏ –≤–≤–æ–¥–∏—Ç –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
     ```typescript
     {
       items: [
         { name: "–Ø–±–ª–æ–∫–∏ 2–∫–≥", checked: true },
         { name: "–ì—Ä—É—à–∏ 1.5–∫–≥", checked: true },
         { name: "–ë–∞–Ω–∞–Ω—ã 1–∫–≥", checked: true }
       ],
       allItemsPresent: true
     }
     ```
   - –ö—É—Ä—å–µ—Ä ‚Üí "–ó–∞–±—Ä–∞–ª –∑–∞–∫–∞–∑"
   - –°—Ç–∞—Ç—É—Å: `IN_DELIVERY`
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É: "–ö—É—Ä—å–µ—Ä –∑–∞–±—Ä–∞–ª –∑–∞–∫–∞–∑ –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫ –≤–∞–º"

**API:** `POST /delivery/orders/:id/pickup`

---

## 4. –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç—É

**–ê–∫—Ç–æ—Ä:** Courier

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞:**
   ```typescript
   const route = await routingService.buildRoute({
     from: courier.currentLocation,
     to: order.deliveryAddress.coordinates,
     optimize: true,  // –£—á—ë—Ç –ø—Ä–æ–±–æ–∫
     waypoints: courier.currentOrders.map(o => o.deliveryAddress)  // –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤
   });
   
   // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∫—É—Ä—å–µ—Ä–∞
   ```

2. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**
   ```typescript
   // –ö—É—Ä—å–µ—Ä –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
   socket.on("courier-location-update", async (data) => {
     await Courier.updateOne(
       { _id: courierId },
       { 
         currentLocation: data.coordinates,
         lastLocationUpdate: new Date()
       }
     );
     
     // –ü–µ—Ä–µ—Å—á—ë—Ç ETA
     const newETA = calculateETAFromCurrentLocation(
       data.coordinates,
       order.deliveryAddress.coordinates
     );
     
     // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É, –µ—Å–ª–∏ –∑–∞–¥–µ—Ä–∂–∫–∞ >10 –º–∏–Ω—É—Ç
     if (newETA - order.estimatedDeliveryTime > 10) {
       notifyCustomer("–ö—É—Ä—å–µ—Ä –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 10 –º–∏–Ω—É—Ç –∏–∑-–∑–∞ –ø—Ä–æ–±–æ–∫");
     }
     
     // –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç –∫—É—Ä—å–µ—Ä–∞ –Ω–∞ –∫–∞—Ä—Ç–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
     emitToCustomer(order.customer, "courier-location", {
       coordinates: data.coordinates,
       eta: newETA
     });
   });
   ```

3. **–ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –∫ –∞–¥—Ä–µ—Å—É:**
   - –ö–æ–≥–¥–∞ –∫—É—Ä—å–µ—Ä –≤ 500–º –æ—Ç –∞–¥—Ä–µ—Å–∞:
     - Push –∫–ª–∏–µ–Ω—Ç—É: "–ö—É—Ä—å–µ—Ä —Ä—è–¥–æ–º! –ü—Ä–∏–±—É–¥–µ—Ç —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã"
     - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∑–≤–æ–Ω–∏—Ç—å –∫—É—Ä—å–µ—Ä—É

4. **–ü—Ä–∏–±—ã—Ç–∏–µ:**
   - –ö—É—Ä—å–µ—Ä –Ω–∞ –º–µ—Å—Ç–µ ‚Üí "–Ø –Ω–∞ –º–µ—Å—Ç–µ"
   - –°—Ç–∞—Ç—É—Å: `COURIER_AT_LOCATION`
   - –ó–≤–æ–Ω–æ–∫/–¥–æ–º–æ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç—É

5. **–ü–µ—Ä–µ–¥–∞—á–∞ –∑–∞–∫–∞–∑–∞:**
   - –ö—É—Ä—å–µ—Ä ‚Üí "–ü–µ—Ä–µ–¥–∞—Ç—å –∑–∞–∫–∞–∑"
   - –ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ (4 —Ü–∏—Ñ—Ä—ã):
     ```
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ –ö–æ–¥ –ø–µ—Ä–µ–¥–∞—á–∏:    ‚îÇ
     ‚îÇ                  ‚îÇ
     ‚îÇ      8347        ‚îÇ
     ‚îÇ                  ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ```
   - –ö—É—Ä—å–µ—Ä –≤–≤–æ–¥–∏—Ç –∫–æ–¥ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
   - –ï—Å–ª–∏ –Ω–∞–ª–∏—á–Ω—ã–π —Ä–∞—Å—á—ë—Ç:
     ```typescript
     {
       paymentMethod: "CASH",
       totalAmount: 2500,
       cashReceived: 3000,
       change: 500
     }
     ```

6. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:**
   - –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞: `DELIVERED`
   - –°—Ç–∞—Ç—É—Å –∫—É—Ä—å–µ—Ä–∞: `AVAILABLE` (–∏–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–∫–∞–∑)
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
     ```typescript
     {
       courier: {
         todayDeliveries: +1,
         totalEarnings: +deliveryFee,
         avgDeliveryTime: recalculate()
       }
     }
     ```
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
     - –ö–ª–∏–µ–Ω—Ç—É: "–ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω! –û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç–∞–≤–∫–∏"
     - –ú–∞–≥–∞–∑–∏–Ω—É: "–ó–∞–∫–∞–∑ #12345 —É—Å–ø–µ—à–Ω–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω"

**API:** `POST /delivery/orders/:id/complete`

### –û—Å–æ–±—ã–µ —Å–ª—É—á–∞–∏

#### –ö–ª–∏–µ–Ω—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ö—É—Ä—å–µ—Ä –∂–¥—ë—Ç 10 –º–∏–Ω—É—Ç
2. –ó–≤–æ–Ω–∏—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ
3. –ï—Å–ª–∏ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Üí "–ö–ª–∏–µ–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
4. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã:
   - –û—Å—Ç–∞–≤–∏—Ç—å —É –¥–≤–µ—Ä–∏ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ)
   - –û—Å—Ç–∞–≤–∏—Ç—å —É —Å–æ—Å–µ–¥–µ–π
   - –í–µ—Ä–Ω—É—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω
5. –§–æ—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

#### –û—Ç–∫–∞–∑ –æ—Ç –∑–∞–∫–∞–∑–∞

1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑
2. –ö—É—Ä—å–µ—Ä ‚Üí "–ö–ª–∏–µ–Ω—Ç –æ—Ç–∫–∞–∑–∞–ª—Å—è"
3. –£–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É: "–î–æ–ª–≥–æ –∂–¥–∞–ª", "–ù–µ —É—Å—Ç—Ä–æ–∏–ª —Å–æ—Å—Ç–∞–≤" –∏ —Ç.–¥.
4. –ó–∞–∫–∞–∑ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω
5. –°—Ç–∞—Ç—É—Å: `RETURNED`

---

## 5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–º—É–ª—å—Ç–∏–∑–∞–∫–∞–∑)

**–ê–∫—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–∞

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

–ö–æ–≥–¥–∞ –∫—É—Ä—å–µ—Ä—É –Ω–∞–∑–Ω–∞—á–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤, —Å–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:

```typescript
async function optimizeRoute(courier: Courier, orders: Order[]): Promise<Order[]> {
  // –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –∫—É—Ä—å–µ—Ä–∞
  const start = courier.currentLocation;
  
  // –í—Å–µ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
  const destinations = orders.map(o => ({
    order: o,
    coordinates: o.deliveryAddress.coordinates,
    priority: calculateOrderPriority(o)
  }));
  
  // –ê–ª–≥–æ—Ä–∏—Ç–º TSP (Travelling Salesman Problem)
  const optimizedRoute = solveTSP(start, destinations);
  
  // –£—á—ë—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (—Å—Ä–æ—á–Ω—ã–µ –∑–∞–∫–∞–∑—ã –ø–µ—Ä–≤—ã–º–∏)
  return optimizedRoute.sort((a, b) => {
    if (a.isUrgent && !b.isUrgent) return -1;
    if (!a.isUrgent && b.isUrgent) return 1;
    return a.sequenceNumber - b.sequenceNumber;
  });
}

function calculateOrderPriority(order: Order): number {
  let priority = 0;
  
  // –ü—Ä–µ–≤—ã—à–µ–Ω SLA
  if (order.slaDeadline < new Date()) priority += 100;
  
  // VIP –∫–ª–∏–µ–Ω—Ç
  if (order.customer.tier === "GOLD") priority += 50;
  
  // –°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
  if (order.deliveryType === "EXPRESS") priority += 30;
  
  // –î–æ–ª–≥–æ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏
  const waitTime = (new Date() - order.readyAt) / 60000;  // –º–∏–Ω—É—Ç—ã
  priority += waitTime;
  
  return priority;
}
```

**–ü—Ä–∏–º–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞:**

```
–¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è: –ú–∞–≥–∞–∑–∏–Ω –ê
‚îÇ
‚îú‚îÄ –ó–∞–∫–∞–∑ #12345 (500–º) - —Å—Ä–æ—á–Ω—ã–π
‚îÇ  ETA: 5 –º–∏–Ω
‚îÇ
‚îú‚îÄ –ó–∞–∫–∞–∑ #12346 (800–º –æ—Ç #12345)
‚îÇ  ETA: 12 –º–∏–Ω
‚îÇ
‚îî‚îÄ –ó–∞–∫–∞–∑ #12347 (1.2–∫–º –æ—Ç #12346)
   ETA: 20 –º–∏–Ω

–û–±—â–µ–µ –≤—Ä–µ–º—è: 20 –º–∏–Ω—É—Ç
–û–±—â–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 2.5 –∫–º
```

---

## 6. –°–∞–º–æ–≤—ã–≤–æ–∑

**–ê–∫—Ç–æ—Ä:** Customer

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –≤—ã–±–∏—Ä–∞–µ—Ç "–°–∞–º–æ–≤—ã–≤–æ–∑"
2. –í—ã–±–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏:
   ```
   –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω –¥–ª—è —Å–∞–º–æ–≤—ã–≤–æ–∑–∞:
   
   üìç –§—Ä—É–∫—Ç–æ–≤–∞—è –±–∞–∑–∞ (—É–ª. –¢–æ–ª–µ –±–∏, 45)
      –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 2 –∫–º
      –†–µ–∂–∏–º: 08:00 - 22:00
      [–í—ã–±—Ä–∞—Ç—å]
   
   üìç Fruit Market (–ø—Ä. –ê–±–∞—è, 120)
      –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 5 –∫–º
      –†–µ–∂–∏–º: 09:00 - 21:00
      [–í—ã–±—Ä–∞—Ç—å]
   ```

3. –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—Ç–∞:
   ```
   –ö–æ–≥–¥–∞ –∑–∞–±–µ—Ä—ë—Ç–µ?
   
   [ ] –ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ (~20 –º–∏–Ω)
   [‚úì] –°–µ–≥–æ–¥–Ω—è 18:00 - 19:00
   [ ] –ó–∞–≤—Ç—Ä–∞ 10:00 - 11:00
   ```

4. –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω:
   ```typescript
   {
     deliveryType: "PICKUP",
     pickupShop: shopId,
     pickupTimeSlot: {
       from: "2024-12-05 18:00",
       to: "2024-12-05 19:00"
     },
     pickupCode: "8347"  // –ö–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è
   }
   ```

5. –ö–æ–≥–¥–∞ –∑–∞–∫–∞–∑ –≥–æ—Ç–æ–≤:
   - SMS/Push: "–ó–∞–∫–∞–∑ #12345 –≥–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ! –ö–æ–¥: 8347"
   - QR-–∫–æ–¥ –¥–ª—è –ø–æ–∫–∞–∑–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ

6. **–í—ã–¥–∞—á–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ:**
   - –ö–ª–∏–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç QR-–∫–æ–¥ –∏–ª–∏ –Ω–∞–∑—ã–≤–∞–µ—Ç –∫–æ–¥
   - –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç/–≤–≤–æ–¥–∏—Ç ‚Üí –≤–∏–¥–∏—Ç –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
   - –°—Ç–∞—Ç—É—Å: `DELIVERED`
   - –ö–ª–∏–µ–Ω—Ç –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–±–æ—Ä–∫–∏

**API:** `POST /delivery/pickup/:id/complete`

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–≤–æ–¥–∫–∞

### –°—É—â–Ω–æ—Å—Ç—å Delivery

```typescript
{
  order: ObjectId,
  courier?: ObjectId,
  
  type: "COURIER" | "PICKUP" | "PARTNER",
  
  deliveryAddress?: {
    fullAddress: string,
    coordinates: { lat: number, lng: number },
    entrance?: string,
    floor?: string,
    apartment?: string,
    instructions?: string  // "–û—Å—Ç–∞–≤–∏—Ç—å —É –¥–≤–µ—Ä–∏", "–ù–µ –∑–≤–æ–Ω–∏—Ç—å"
  },
  
  pickupShop?: ObjectId,
  pickupTimeSlot?: {
    from: Date,
    to: Date
  },
  pickupCode?: string,
  
  zone: DeliveryZone,
  distance: number,
  price: number,
  
  status: "PENDING" | "COURIER_ASSIGNED" | "COURIER_AT_SHOP" | 
          "IN_DELIVERY" | "COURIER_AT_LOCATION" | "DELIVERED" | 
          "FAILED" | "RETURNED",
  
  timeline: [{
    status: string,
    timestamp: Date,
    coordinates?: { lat: number, lng: number },
    note?: string
  }],
  
  estimatedDeliveryTime: Date,
  actualDeliveryTime?: Date,
  
  route?: {
    distance: number,
    duration: number,
    waypoints: Coordinate[]
  },
  
  rating?: {
    score: number,
    comment?: string,
    tags?: string[]
  }
}
```

### –°—É—â–Ω–æ—Å—Ç—å Courier

```typescript
{
  user: ObjectId,
  
  status: "AVAILABLE" | "BUSY" | "OFFLINE",
  onlineStatus: "ONLINE" | "OFFLINE",
  
  currentLocation: {
    lat: number,
    lng: number,
    updatedAt: Date
  },
  
  currentOrders: ObjectId[],  // –ú–∞–∫—Å. 3
  
  workZones: string[],  // ["zone_center", "zone_medium"]
  
  vehicle: {
    type: "BIKE" | "CAR" | "SCOOTER" | "WALKING",
    plate?: string
  },
  
  stats: {
    totalDeliveries: number,
    successfulDeliveries: number,
    todayDeliveries: number,
    avgDeliveryTime: number,
    rating: number,
    totalEarnings: number
  },
  
  shift?: {
    startedAt: Date,
    scheduledEndAt: Date
  }
}
```

### API

**Customer:**
- `POST /delivery/calculate` - —Ä–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏
- `GET /orders/:id/delivery-tracking` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏
- `POST /delivery/pickup/:id/complete` - –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–∞–º–æ–≤—ã–≤–æ–∑
- `POST /orders/:id/rate-delivery` - –æ—Ü–µ–Ω–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É

**Courier:**
- `GET /courier/orders/active` - –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã
- `POST /courier/orders/:id/pickup` - –∑–∞–±—Ä–∞–ª –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞
- `POST /courier/orders/:id/complete` - –∑–∞–≤–µ—Ä—à–∏–ª –¥–æ—Å—Ç–∞–≤–∫—É
- `POST /courier/location` - –æ–±–Ω–æ–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
- `POST /courier/status` - –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å (–¥–æ—Å—Ç—É–ø–µ–Ω/–∑–∞–Ω—è—Ç)

**Shop:**
- `GET /shop/orders/ready-for-delivery` - –∑–∞–∫–∞–∑—ã –≥–æ—Ç–æ–≤—ã–µ –∫ –¥–æ—Å—Ç–∞–≤–∫–µ
- `POST /shop/orders/:id/ready` - –∑–∞–∫–∞–∑ –≥–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ –∫—É—Ä—å–µ—Ä—É

**Platform:**
- `POST /delivery/assign-courier` - –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∫—É—Ä—å–µ—Ä–∞
- `GET /delivery/couriers/available` - –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫—É—Ä—å–µ—Ä—ã
- `GET /delivery/analytics` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
- `POST /delivery/zones` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–æ–Ω–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

### –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞

1. **–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞** –ø—Ä–∏ –∑–∞–∫–∞–∑–µ >5000‚ÇΩ
2. **–ú–∞–∫—Å. 3 –∑–∞–∫–∞–∑–∞** —É –∫—É—Ä—å–µ—Ä–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
3. **–ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ** –≤ —Ç–µ—á–µ–Ω–∏–µ 2 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
4. **–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞–∫–∞–∑–∞
5. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
6. **SLA –¥–æ—Å—Ç–∞–≤–∫–∏:** 45 –º–∏–Ω—É—Ç —Å –º–æ–º–µ–Ω—Ç–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
7. **–û—Ü–µ–Ω–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏** –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤
8. **–°–∞–º–æ–≤—ã–≤–æ–∑** - —Å–∫–∏–¥–∫–∞ 100% –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É
9. **–í–æ–∑–≤—Ä–∞—Ç** –≤ –º–∞–≥–∞–∑–∏–Ω, –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω >15 –º–∏–Ω—É—Ç
10. **–§–æ—Ç–æ** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ –æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —É –¥–≤–µ—Ä–∏

---

## –ü—Ä–∏–º–µ—Ä—ã

### –†–∞—Å—á—ë—Ç –¥–æ—Å—Ç–∞–≤–∫–∏

```typescript
const delivery = await deliveryService.calculate({
  shopAddress: { lat: 43.238949, lng: 76.889709 },
  customerAddress: { lat: 43.255141, lng: 76.945618 },
  orderAmount: 2500
});

// {
//   zone: "–¶–µ–Ω—Ç—Ä",
//   distance: 5.2,
//   price: 410,
//   eta: 35,
//   freeDeliveryAt: 5000
// }
```

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```typescript
socket.on("delivery-tracking", (orderId) => {
  socket.emit("courier-location", {
    coordinates: { lat: 43.245, lng: 76.920 },
    eta: 12,  // –º–∏–Ω—É—Ç
    status: "IN_DELIVERY",
    distance: 2.1  // –∫–º –¥–æ –∫–ª–∏–µ–Ω—Ç–∞
  });
});
```

---

## –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

**Order Flow:**
- –î–æ—Å—Ç–∞–≤–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ `READY_FOR_DELIVERY`
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –∑–∞–∫–∞–∑ –≤ `DELIVERED`

**Payment Flow:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–ª–∞—Ç—ã –Ω–∞–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏
- –ö—É—Ä—å–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã–µ –∏ –≤–≤–æ–¥–∏—Ç —Å—É–º–º—É

**Rating Flow:**
- –û—Ü–µ–Ω–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–π—Ç–∏–Ω–≥ –∫—É—Ä—å–µ—Ä–∞
- –ù–∏–∑–∫–∏–µ –æ—Ü–µ–Ω–∫–∏ ‚Üí –ø–µ—Ä–µ—Å–º–æ—Ç—Ä —Ä–∞–±–æ—Ç—ã –∫—É—Ä—å–µ—Ä–∞

**Notification Flow:**
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö –¥–æ—Å—Ç–∞–≤–∫–∏
- Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

**Shift Flow:**
- –ö—É—Ä—å–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ —Å–º–µ–Ω–∞–º
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫—É—Ä—å–µ—Ä–∞–º –Ω–∞ —Å–º–µ–Ω–µ

---

> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤  
> **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2024-11-24
