# PRD: Складская система FruktGo

> **Версия:** 2.0  
> **Статус:** Черновик  
> **Для кого:** Владелец бизнеса, продакт-менеджеры

---

## 1. Проблема

**Реальность малого бизнеса:**
- Если инструмент сложнее Excel → им перестают пользоваться
- Данные в системе превращаются в мусор
- Продавец хочет "одну кнопку", а не учёт каждой коробки

**Проблема маркетплейса:**
- Без контроля партий невозможно гарантировать качество
- Продавец может отправить гнилой товар → негатив к платформе
- Нет данных для умных скидок и алертов

**Решение:** Три уровня сложности с **скрытыми партиями на бэкенде**.

---

## 2. Ключевая идея

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     СКРЫТЫЕ ПАРТИИ — ВСЕГДА                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Продавец видит:          Система хранит:                               │
│                                                                         │
│  LITE:    "100 кг"        → 5 партий с разными сроками                  │
│  STANDARD: "3 слота"      → те же 5 партий, сгруппированные             │
│  PRO:     "5 партий"      → полная детализация                          │
│                                                                         │
│  Бэкенд ВСЕГДА знает:                                                   │
│  • Какой товар истекает завтра                                          │
│  • Какой товар свежий                                                   │
│  • Какую партию списать первой (FIFO)                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**Зачем это маркетплейсу:**
- Можем автоматически ставить скидки на истекающий товар
- Можем не отдавать заказ продавцу с гнилью (если нужен "Premium")
- Можем показывать клиенту реальную свежесть товара

---

## 3. Пользователи и роли

| Роль | Описание | Что делает |
|------|----------|------------|
| **Продавец (Seller)** | Владелец бизнеса | Выбирает уровень, управляет товарами |
| **Сотрудник (Employee)** | Работник магазина/склада | Приёмка, списание, инвентаризация |
| **Платформа (System)** | Автоматика FruktGo | Авто-скидки, алерты, контроль качества |
| **Клиент (Customer)** | Покупатель | Видит товар на витрине, делает заказ |

---

## 4. Три уровня системы

### 4.1 LITE — "Режим Тетради"

**Для кого:** Продавец, который хочет одну кнопку.

**Что видит продавец:**
```
┌─────────────────────────────────────────┐
│ 🍎 Яблоки                               │
│                                         │
│        Остаток: 100 кг                  │
│                                         │
│   [+ Приход]     [− Списание]           │
└─────────────────────────────────────────┘
```

**Что делает система "под капотом":**

| Действие продавца | Что делает бэкенд |
|-------------------|-------------------|
| Нажал "+ Приход 50 кг" | Создаёт партию: `срок = сегодня + 14 дней` (из справочника категории), `цена = последняя закупочная` |
| Продал 10 кг | Списывает из самой старой партии (FIFO) |
| Нажал "− Списание 5 кг (порча)" | Списывает из самой старой партии |

**Ограничения:**
- Нет указания даты приёмки (всегда "сегодня")
- Нет указания срока годности (из справочника)
- Нет указания цены (последняя или из справочника)
- Нет выбора, из какой партии списывать

**Преимущество для маркетплейса:**
- Даже при минимальном вводе данных, система знает про партии
- Можем ставить автоскидки на старый товар
- Можем предупреждать о просрочке

---

### 4.2 STANDARD — "Дневные слоты"

**Для кого:** Продавец, который следит за сроками, но без фанатизма.

**Что видит продавец:**
```
┌─────────────────────────────────────────┐
│ 🍎 Яблоки                               │
│                                         │
│  Срок до 06.12 (вчера):  5 кг  ⚠️       │
│  Срок до 07.12 (сегодня): 20 кг         │
│  Срок до 10.12 (+3 дня):  75 кг         │
│                                         │
│   [+ Приход]     [− Списание]           │
└─────────────────────────────────────────┘
```

**Что делает продавец:**
- При приёмке указывает дату срока годности
- При списании может выбрать "слот" (если списывает брак из конкретной партии)

**Что делает система:**

| Действие продавца | Что делает бэкенд |
|-------------------|-------------------|
| Приход 30 кг, срок 10.12 | Ищет партию со сроком 10.12. Нашёл → прибавляет. Не нашёл → создаёт новую |
| Продал 10 кг (обычная продажа) | FIFO: сначала из "06.12", потом из "07.12" |
| Списание 5 кг из слота "06.12" | Списывает из партии с этим сроком |

**Консолидация партий:**
- Партии с **одинаковым сроком** объединяются в один "слот"
- Продавец видит 3 строки, а не 15 партий

**Преимущества:**
- Продавец понимает, что у него есть старый товар (⚠️)
- Может осознанно списать просрочку
- Меньше "шума" чем в PRO

---

### 4.3 PRO — "Эксперт"

**Для кого:** Крупный продавец с полноценным учётом.

**Что видит продавец:**
```
┌─────────────────────────────────────────────────────────────────────────┐
│ 🍎 Яблоки                                                               │
│                                                                         │
│  Партия #P-001 │ 06.12 │ 5 кг  │ 80₽/кг  │ ООО Сады     │ ⚠️ Истекает  │
│  Партия #P-002 │ 07.12 │ 10 кг │ 85₽/кг  │ ООО Сады     │              │
│  Партия #P-003 │ 07.12 │ 10 кг │ 82₽/кг  │ ИП Иванов    │              │
│  Партия #P-004 │ 10.12 │ 50 кг │ 78₽/кг  │ ООО Сады     │              │
│  Партия #P-005 │ 10.12 │ 25 кг │ 80₽/кг  │ ИП Иванов    │              │
│                                                                         │
│   [+ Приход]     [Переместить]     [Списать]     [Инвентаризация]       │
└─────────────────────────────────────────────────────────────────────────┘
```

**Дополнительные возможности:**
- Указание поставщика и номера накладной
- Указание закупочной цены для каждой партии
- Перемещение между локациями (склад → магазин)
- Динамический срок годности (пересчёт по условиям хранения)
- Инвентаризация с корректировкой по партиям

**Premium-функция: Управление свежестью**
- Система пересчитывает срок при перемещении
- Если товар был в тепле → срок уменьшается
- Если товар был в холоде → срок сохраняется/увеличивается

---

## 5. Локации и структура

### 5.1 Типы локаций

| Тип | Описание | Пример |
|-----|----------|--------|
| **WAREHOUSE** | Только хранение, нет продаж | Центральный склад |
| **SHOP** | Хранение + продажи | Магазин на Ленина |

### 5.2 Структура продавца

```
Продавец "Фруктовая база"
│
├── 📦 Центральный склад (WAREHOUSE)
│   └── Товар развозится по магазинам
│
├── 🏪 Магазин на Ленина (SHOP)
│   ├── Торговый зал + подсобка = единый остаток
│   └── Онлайн + офлайн продажи
│
└── 🏪 Магазин на рынке (SHOP, только офлайн)
    └── Только офлайн продажи
```

### 5.3 Единый остаток магазина

**Важно:** В магазине нет разделения "витрина / подсобка".

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   МАГАЗИН = ОДИН ОСТАТОК                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ❌ НЕ ТАК:                                                             │
│     Витрина: 20 кг  │  Подсобка: 80 кг                                  │
│                                                                         │
│  ✅ А ТАК:                                                              │
│     Всего в магазине: 100 кг                                            │
│     Зарезервировано под заказы: 15 кг                                   │
│     Доступно: 85 кг                                                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**Почему так:**
- Продавец не будет вести учёт "где физически лежит коробка"
- Упрощает работу сотрудника
- Резерв — виртуальный, а не физический

---

## 6. Резервирование и конфликты

### 6.1 Мягкое резервирование

Когда клиент делает онлайн-заказ, товар **резервируется**, но не блокируется физически.

```
Было:     Яблоки 100 кг

Заказ #1: 10 кг (онлайн)
Заказ #2: 5 кг (онлайн)

Стало:
  Всего: 100 кг
  Резерв: 15 кг
  Доступно онлайн: 85 кг
  Доступно офлайн: 100 кг (видит сотрудник)
```

### 6.2 Приоритет офлайн-покупателя

**Ситуация:** Клиент в магазине хочет купить товар, который зарезервирован под онлайн-заказ.

**Правило:** Физический покупатель важнее.

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   КОНФЛИКТ: ОНЛАЙН vs ОФЛАЙН                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Остаток: 50 кг                                                         │
│  Резерв: 45 кг (3 онлайн-заказа)                                        │
│  Доступно: 5 кг                                                         │
│                                                                         │
│  Покупатель в магазине: "Хочу 10 кг"                                    │
│                                                                         │
│  ВАРИАНТЫ:                                                              │
│                                                                         │
│  1. "Извините, есть только 5 кг"                                        │
│     → Продавец сам решает                                               │
│                                                                         │
│  2. "Продаём 10 кг, забираем из резерва"                                │
│     → Система предупреждает: "⚠️ Затронет заказ #1234"                  │
│     → Продавец подтверждает                                             │
│     → Онлайн-клиенту уведомление: "Часть заказа недоступна"             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**Логика:**
1. Если заказ **ещё не собирается** → можно забрать из резерва
2. Если заказ **уже собирается** → нельзя (товар в руках сборщика)
3. Уведомление онлайн-клиенту **обязательно**

---

## 7. Операции с товаром

### 7.1 Приёмка

**Что происходит:** Товар поступает от поставщика.

| Уровень | Что вводит продавец | Что делает система |
|---------|---------------------|-------------------|
| LITE | Только количество | Срок из справочника, цена последняя |
| STANDARD | Количество + срок годности | Консолидация по срокам |
| PRO | Всё: количество, срок, цена, поставщик, накладная | Полный учёт |

**Результат:** Создаётся партия (или пополняется существующая в STANDARD).

### 7.2 Продажа (онлайн)

**Что происходит:** Клиент делает заказ через приложение.

1. Система **резервирует** товар (FIFO: сначала старые партии)
2. Сборщик **собирает** заказ
3. При отгрузке товар **списывается** из партий

**FIFO-логика:**
```
Партии:
  #P-001: срок 06.12, 5 кг
  #P-002: срок 07.12, 20 кг

Заказ: 10 кг

Резерв:
  Из #P-001: 5 кг (вся партия)
  Из #P-002: 5 кг
```

### 7.3 Продажа (офлайн)

**Что происходит:** Покупатель в магазине.

1. Сотрудник продаёт "мимо кассы" или через POS
2. Система **списывает** товар (FIFO)
3. Если затронут резерв → уведомление онлайн-клиенту

### 7.4 Списание

**Причины списания:**
- Истёк срок годности
- Порча (гниль, плесень)
- Повреждение
- Кража/недостача
- Для производства (смузи, нарезка)

| Уровень | Как списывает |
|---------|---------------|
| LITE | Просто количество → из самой старой партии |
| STANDARD | Может выбрать "слот" (день) |
| PRO | Выбирает конкретную партию |

### 7.5 Перемещение (только PRO)

**Что происходит:** Товар перевозится со склада в магазин.

```
Склад → Магазин на Ленина

Партия #P-001:
  До: на складе-холодильнике (коэф. 0.5)
  После: в магазине (коэф. 1.0)
  
  Пересчёт срока:
    Было: срок до 15.12 (10 дней свежести)
    Стало: срок до 12.12 (пересчитано по коэффициенту)
```

### 7.6 Инвентаризация

**Что происходит:** Сверка факта с системой.

| Уровень | Как проводится |
|---------|----------------|
| LITE | "Всего 95 кг" → система корректирует из старых партий |
| STANDARD | По слотам: "06.12: 3 кг, 07.12: 18 кг..." |
| PRO | По партиям с полной детализацией |

---

## 8. Витрина магазина (Storefront)

### 8.1 Структура

```
Магазин
└── Витрина (Storefront)
    ├── Товар: Яблоки
    │   ├── Цена онлайн: 150₽/кг
    │   ├── Цена офлайн: 140₽/кг
    │   ├── Скидка: 20% (истекает)
    │   └── Фото с витрины
    │
    └── Товар: Груши
        ├── Цена онлайн: 180₽/кг
        └── ...
```

### 8.2 Ценообразование

**Три типа цен:**
1. **Рекомендованная** (из справочника товара) — ориентир
2. **Онлайн** — для заказов через приложение
3. **Офлайн** — для покупок в магазине (обычно ниже)

**Почему онлайн дороже:**
- Работа сборщика
- Доставка
- Упаковка

### 8.3 Автоскидки по сроку (все уровни)

**Правила по умолчанию:**

| Дней до истечения | Скидка |
|-------------------|--------|
| ≤ 7 дней | 10% |
| ≤ 5 дней | 20% |
| ≤ 3 дня | 30% |
| ≤ 1 день | 50% |

**Важно:** Автоскидки применяются **только к онлайн-цене**.

**Пример:**
```
Яблоки: онлайн 150₽/кг
Есть партия со сроком 08.12 (2 дня)

Система:
  → Автоскидка 30%
  → Новая онлайн-цена: 105₽/кг
  → На витрине: "🔥 Скидка! Было 150₽, стало 105₽"
```

---

## 9. Алерты и уведомления

### 9.1 Типы алертов

| Тип | Условие | Действие |
|-----|---------|----------|
| ⚠️ WARNING | 3-7 дней до истечения | Уведомление продавцу |
| 🔴 CRITICAL | < 3 дней | Уведомление + автоскидка |
| ⛔ EXPIRED | Срок истёк | Уведомление + блокировка для онлайн |

### 9.2 Ежедневный отчёт (Telegram)

```
📊 Отчёт по срокам за 07.12.2024
Магазин: На Ленина

🟢 В норме: 32 позиции
🟡 Внимание: 8 позиций
🔴 Критично: 4 позиции
⛔ Истекло: 1 позиция

🔴 СРОЧНО:
• Клубника: 2 кг, до 08.12 → Скидка 30%
• Творог: 10 шт, до 07.12 → Скидка 50%

⛔ СПИСАТЬ:
• Салат: 1.5 кг, истёк 06.12
```

### 9.3 Автоматическая блокировка

**Истёкший товар:**
- Автоматически скрывается с онлайн-витрины
- Продавцу уведомление: "Списать!"
- Через 24ч → автоматическое списание (если не сделал вручную)

---

## 10. Переключение между уровнями

### 10.1 LITE → STANDARD

**Что происходит:**
- Все партии остаются
- Продавец видит агрегацию по срокам
- Никакой миграции данных не нужно

### 10.2 STANDARD → PRO

**Что происходит:**
- Консолидированные партии **разъединяются** (если были слиты)
- Появляется полный UI
- Включается динамическое управление свежестью (опционально)

### 10.3 PRO → STANDARD / LITE

**Что происходит:**
- Данные **не теряются**
- Просто UI показывает меньше
- Консолидация партий в STANDARD включается автоматически

---

## 11. Сценарии из жизни

### Сценарий 1: Начинающий продавец (LITE)

```
Ахмет открыл точку на рынке. Раньше вёл учёт в тетрадке.

День 1:
  • Закупил 100 кг яблок
  • Открыл приложение → [+ Приход] → ввёл "100"
  • Система создала партию (срок +14 дней, цена из справочника)

День 3:
  • Продал ~40 кг за день
  • Вечером открыл приложение → [− Списание] → ввёл "40"
  • Система списала из самой старой партии

День 7:
  • Докупил ещё 50 кг
  • [+ Приход] → "50"
  • Система создала новую партию

День 10:
  • Ахмет видит: "Остаток: 110 кг"
  • Система знает: партия 1 (30 кг, истекает через 4 дня), партия 2 (80 кг, свежая)
  • Автоскидка на первую партию → на витрине "🔥 Скидка 20%"
```

### Сценарий 2: Продавец со следящим за сроками (STANDARD)

```
Марина — ответственная. Хочет видеть сроки, но без фанатизма.

Приёмка:
  • Привезли 50 кг клубники, срок до 10.12
  • [+ Приход] → количество: 50, срок: 10.12
  • Система: ищет партию с 10.12 → нет → создаёт новую

На следующий день:
  • Ещё 30 кг клубники, срок 10.12
  • [+ Приход] → 30, срок 10.12
  • Система: партия с 10.12 есть → прибавляет (теперь 80 кг)

Через 3 дня:
  • Марина видит:
    ┌─────────────────────────────────┐
    │ 🍓 Клубника                     │
    │ До 10.12: 75 кг  ⚠️ 2 дня      │
    │ До 15.12: 40 кг                 │
    └─────────────────────────────────┘
  • Понимает: нужно продать первую партию быстрее
```

### Сценарий 3: Конфликт онлайн/офлайн

```
Магазин "На Ленина", 14:00

Состояние:
  • Яблоки: 50 кг
  • Резерв: 45 кг (заказы #1, #2, #3)
  • Доступно онлайн: 5 кг

Покупатель в магазине: "Дайте 20 кг яблок"

Сотрудник видит на экране:
  ┌─────────────────────────────────────────────┐
  │ ⚠️ Недостаточно свободного товара          │
  │                                             │
  │ Доступно: 5 кг                              │
  │ Нужно: 20 кг                                │
  │                                             │
  │ Варианты:                                   │
  │ [Продать 5 кг]                              │
  │ [Взять из резерва] ← затронет заказ #1      │
  └─────────────────────────────────────────────┘

Сотрудник выбирает "Взять из резерва":
  • Резерв заказа #1 снимается
  • Клиенту #1 уведомление: "Часть заказа недоступна"
  • Продажа офлайн: 20 кг
```

### Сценарий 4: Возврат товара

```
Курьер вернул заказ — клиент не открыл дверь.
Клубника была вне холодильника 2 часа.

Сотрудник оценивает:
  • Время вне контроля: 2 часа
  • Состояние: хорошее (не помялась)

Система рекомендует:
  ┌─────────────────────────────────────────────┐
  │ 🍓 Клубника, 2 кг                           │
  │                                             │
  │ Состояние: ХОРОШЕЕ                          │
  │ Время вне контроля: 2 часа                  │
  │                                             │
  │ Рекомендация: Вернуть со скидкой 20%        │
  │                                             │
  │ [На полку] [Со скидкой] [Списать]           │
  └─────────────────────────────────────────────┘

Сотрудник выбирает "Со скидкой":
  • Клубника возвращается в остаток
  • На витрине автоматически скидка 20%
  • Срок годности пересчитан (минус 2 часа в тепле)
```

---

## 12. Метрики успеха

| Метрика | Цель |
|---------|------|
| % продавцов, ведущих учёт | > 80% |
| Среднее время на приёмку | < 2 минут |
| % списаний по просрочке | < 5% |
| Жалобы на качество товара | < 1% заказов |
| Конверсия автоскидок | > 70% (товар продан до истечения) |

---

## 13. Ограничения MVP

| Что | Статус |
|-----|--------|
| Три уровня (LITE/STANDARD/PRO) | ✅ MVP |
| Скрытые партии на бэкенде | ✅ MVP |
| Автоскидки по сроку | ✅ MVP |
| Перемещения между локациями | PRO only |
| Динамическое управление свежестью | PRO only, Premium |
| Интеграция с датчиками температуры | Будущее |
| Автоматический заказ у поставщика | Будущее |

---

## 14. Глоссарий

| Термин | Определение |
|--------|-------------|
| **Партия (Batch)** | Конкретная поставка товара с определённым сроком |
| **FIFO** | First In, First Out — продаём сначала старое |
| **FEFO** | First Expired, First Out — продаём сначала то, что истекает раньше |
| **Слот** | Группа партий с одинаковым сроком (в STANDARD) |
| **Резерв** | Товар, отложенный под онлайн-заказ |
| **Витрина (Storefront)** | Онлайн-представление магазина с ценами и товарами |
| **Автоскидка** | Скидка, автоматически применяемая при приближении срока |
