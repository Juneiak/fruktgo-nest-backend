# –ê–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—è New Inventory (v2)

–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: 06.12.2025
–°—Ç–∞—Ç—É—Å: ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—è `new-inventory` –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π (`inventory-system-overview.md`).

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

–ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ DDD –∏ —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (Ports & Adapters). –¢–∏–ø–∏–∑–∞—Ü–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ DTO –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ. –û–¥–Ω–∞–∫–æ –≤—ã—è–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∏—Å–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (Blockers)

### 1. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å Storefront (–í–∏—Ç—Ä–∏–Ω—ã)
**–§–∞–π–ª:** `entities/storefront/storefront.schema.ts`
**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–æ–≤–∞—Ä—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ –≤–ª–æ–∂–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ (`products: StorefrontProduct[]`) –≤–Ω—É—Ç—Ä–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ `Storefront`.
**–†–∏—Å–∫:** MongoDB –∏–º–µ–µ—Ç –∂–µ—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç –Ω–∞ —Ä–∞–∑–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ **16MB**.
- –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ 1000+ —Ç–æ–≤–∞—Ä–æ–≤ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏, –∏—Å—Ç–æ—Ä–∏–µ–π —Ü–µ–Ω –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç –º–∞–≥–∞–∑–∏–Ω–∞ –±—ã—Å—Ç—Ä–æ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç —ç—Ç–æ–≥–æ –ª–∏–º–∏—Ç–∞.
- –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—ã ‚Äî –º–∞–≥–∞–∑–∏–Ω "–≤—Å—Ç–∞–Ω–µ—Ç".
**–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ `StorefrontProduct` –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏ —Å–≤—è–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ `storefrontId` –∏–ª–∏ `shopId`.

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ "–ñ–∏–≤—ã–µ —Ñ–æ—Ç–æ" (Live Photos)
**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –†–∞–∑–¥–µ–ª 3 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ("–ñ–∏–≤—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤–∏—Ç—Ä–∏–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤").
**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –∫–æ–¥–µ.
- –ù–µ—Ç –ø–æ–ª–µ–π `takenAt`, `takenBy`, `isActive` –≤ —Å—Ö–µ–º–∞—Ö.
- –ù–µ—Ç –ª–æ–≥–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ç–æ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π.
- –ù–µ—Ç API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–º–µ–Ω–Ω–æ "–∂–∏–≤—ã—Ö" —Ñ–æ—Ç–æ (–æ—Ç–ª–∏—á–∞—é—â–∏—Ö—Å—è –æ—Ç —Å—Ç—É–¥–∏–π–Ω—ã—Ö).
**–†–∏—Å–∫:** –ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –¥–æ–≤–µ—Ä–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤.

### 3. –ù–µ–ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π (Transfer)
**–§–∞–π–ª:** `operations/transfer/transfer.service.ts` (—Å—Ç—Ä–æ–∫–∞ ~215)
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –∫–æ–¥–µ –æ—Å—Ç–∞–≤–ª–µ–Ω TODO: `// TODO: –ø–æ–ª—É—á–∏—Ç—å —É—Å–ª–æ–≤–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏`.
```typescript
const newDegradationCoefficient = 1.0; // Hardcoded
```
**–†–∏—Å–∫:** –ü—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ –≤ —Ç–µ–ø–ª–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–∞ **–Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç** —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –≠—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é "–£–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤–µ–∂–µ—Å—Ç—å—é" –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–¥–∞–∂–µ –∏—Å–ø–æ—Ä—á–µ–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞.

---

## üü° –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (Warnings)

### 4. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –ø—Ä–æ–¥—É–∫—Ç–∞
**–°—É—â–Ω–æ—Å—Ç–∏:**
1. `entities/product-template` (–®–∞–±–ª–æ–Ω –ø—Ä–æ–¥–∞–≤—Ü–∞, —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –º–∞—Å—Ç–µ—Ä `Product`)
2. `entities/inventory-product` (–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π –ø—Ä–æ–¥—É–∫—Ç)
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±–µ —Å—É—â–Ω–æ—Å—Ç–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è, —É—Å—É—à–∫–∏ –∏ –¥–æ–ø—É—Å–∫–æ–≤. –ù–µ—è—Å–Ω–æ, –∫–∞–∫–∞—è –∏–∑ –Ω–∏—Ö —è–≤–ª—è–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã.
- –ï—Å–ª–∏ `InventoryProduct` –∑–∞–¥—É–º—ã–≤–∞–ª—Å—è –∫–∞–∫ –∑–∞–º–µ–Ω–∞ `ProductTemplate`, —Ç–æ —Å—Ç–∞—Ä—É—é —Å—É—â–Ω–æ—Å—Ç—å –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å.
- –ï—Å–ª–∏ –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã —Å–æ—Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫.

### 5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫
**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥—É–ª–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ—Ä–µ–Ω—å), —á—Ç–æ –º–æ–∂–µ—Ç —É—Å–ª–æ–∂–Ω–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –Ω–æ–≤—ã–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º, —Ö–æ—Ç—è –∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –∫–æ–¥–∞.

---

## ‚úÖ –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–î–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:

1.  **Refactor Storefront Schema (Critical)**
    - [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—É `StorefrontProduct` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é (`@Schema({ collection: 'inventory_storefront_products' })`).
    - [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `storefront: Types.ObjectId` (–∏–ª–∏ `shop: Types.ObjectId`) –¥–ª—è —Å–≤—è–∑–∏.
    - [ ] –£–¥–∞–ª–∏—Ç—å –º–∞—Å—Å–∏–≤ `products` –∏–∑ —Å—Ö–µ–º—ã `Storefront`.

2.  **Implement Transfer Logic**
    - [ ] –í `TransferService.send` –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ü–µ–ª–µ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏ (`StorageLocation`).
    - [ ] –ò–∑–≤–ª–µ–∫–∞—Ç—å `degradationCoefficient` –∏–∑ —Ü–µ–ª–µ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏.
    - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ShelfLifeCalculator` –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ `effectiveExpirationDate` —Å –Ω–æ–≤—ã–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º.

3.  **Implement Live Photos**
    - [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É `StorefrontProduct`, –¥–æ–±–∞–≤–∏–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `LivePhoto` (url, takenAt, expiresAt, isActive).
    - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥/Cron-–∑–∞–¥–∞—á—É –¥–ª—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ.

4.  **Cleanup Entities**
    - [ ] –ü—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ –æ –µ–¥–∏–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ (`ProductTemplate` vs `InventoryProduct`) –∏ —É–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç.
