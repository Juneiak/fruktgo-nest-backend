# Alerts ‚Äî –ê–ª–µ—Ä—Ç—ã

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö: –∏—Å—Ç–µ–∫–∞—é—â–∏–µ —Å—Ä–æ–∫–∏, –Ω–∞—Ä—É—à–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, –Ω–∏–∑–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏.

---

## –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –∞–ª–µ—Ä—Ç—ã?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å: —É —Ç–µ–±—è 500 —Ç–æ–≤–∞—Ä–æ–≤ –≤ 3 –º–∞–≥–∞–∑–∏–Ω–∞—Ö. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –≤—Å–µ–º –≤—Ä—É—á–Ω—É—é.

**–ê–ª–µ—Ä—Ç—ã = —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–Ω–µ–≥–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**

```
üî¥ CRITICAL: –ú–æ–ª–æ–∫–æ "–ü—Ä–æ—Å—Ç–æ–∫–≤–∞—à–∏–Ω–æ" –∏—Å—Ç–µ–∫–∞–µ—Ç –ó–ê–í–¢–†–ê!
üü° WARNING: –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ #2 ‚Äî —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 8¬∞C (–Ω–æ—Ä–º–∞ 2-6¬∞C)
üîµ INFO: –Ø–±–ª–æ–∫–∏ ‚Äî –æ—Å—Ç–∞–ª–æ—Å—å 3 –∫–≥ (–º–∏–Ω–∏–º—É–º 10 –∫–≥)
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
alerts/
‚îú‚îÄ‚îÄ alerts.schema.ts
‚îú‚îÄ‚îÄ alerts.enums.ts
‚îú‚îÄ‚îÄ alerts.commands.ts
‚îú‚îÄ‚îÄ alerts.queries.ts
‚îú‚îÄ‚îÄ alerts.port.ts
‚îú‚îÄ‚îÄ alerts.service.ts
‚îú‚îÄ‚îÄ alerts.module.ts
‚îî‚îÄ‚îÄ index.ts
```

---

## –¢–∏–ø—ã –∞–ª–µ—Ä—Ç–æ–≤

### –ü–æ —Å—Ä–æ–∫–∞–º –≥–æ–¥–Ω–æ—Å—Ç–∏

```
EXPIRING_CRITICAL ‚Äî –ò—Å—Ç–µ–∫–∞–µ—Ç –∑–∞–≤—Ç—Ä–∞! (1-2 –¥–Ω—è)
EXPIRING_SOON     ‚Äî –°–∫–æ—Ä–æ –∏—Å—Ç–µ—á—ë—Ç (3-7 –¥–Ω–µ–π)
EXPIRED           ‚Äî –°—Ä–æ–∫ –∏—Å—Ç—ë–∫, –Ω—É–∂–Ω–æ —Å–ø–∏—Å–∞—Ç—å
```

### –ü–æ —É—Å–ª–æ–≤–∏—è–º —Ö—Ä–∞–Ω–µ–Ω–∏—è

```
TEMPERATURE_DEVIATION ‚Äî –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–Ω–µ –Ω–æ—Ä–º—ã
HUMIDITY_DEVIATION    ‚Äî –í–ª–∞–∂–Ω–æ—Å—Ç—å –≤–Ω–µ –Ω–æ—Ä–º—ã
```

### –ü–æ –æ—Å—Ç–∞—Ç–∫–∞–º

```
LOW_STOCK     ‚Äî –û—Å—Ç–∞—Ç–æ–∫ –Ω–∏–∂–µ –º–∏–Ω–∏–º—É–º–∞
OUT_OF_STOCK  ‚Äî –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
```

### –ü–æ –∫–∞—á–µ—Å—Ç–≤—É

```
FRESHNESS_LOW ‚Äî –°–≤–µ–∂–µ—Å—Ç—å < 3 –∏–∑ 10
```

---

## Severity ‚Äî –í–∞–∂–Ω–æ—Å—Ç—å

```
CRITICAL ‚Äî –¢—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
           (–∏—Å—Ç–µ–∫–∞–µ—Ç –∑–∞–≤—Ç—Ä–∞, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞—è)

WARNING  ‚Äî –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è
           (–∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 3-5 –¥–Ω–µ–π, –Ω–µ–±–æ–ª—å—à–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ)

INFO     ‚Äî –î–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
           (–Ω–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
```

---

## InventoryAlert

### –ü–æ–ª—è

```typescript
InventoryAlert {
  seller,
  
  type,                     // EXPIRING_SOON, TEMPERATURE_DEVIATION...
  severity,                 // CRITICAL, WARNING, INFO
  
  // –ö–æ–Ω—Ç–µ–∫—Å—Ç
  product,                  // –û –∫–∞–∫–æ–º —Ç–æ–≤–∞—Ä–µ
  batch,                    // –û –∫–∞–∫–æ–π –ø–∞—Ä—Ç–∏–∏
  location,                 // –í –∫–∞–∫–æ–π –ª–æ–∫–∞—Ü–∏–∏
  
  // –û–ø–∏—Å–∞–Ω–∏–µ
  message,                  // "–ú–æ–ª–æ–∫–æ –∏—Å—Ç–µ–∫–∞–µ—Ç –∑–∞–≤—Ç—Ä–∞"
  
  data: {                   // –î–µ—Ç–∞–ª–∏ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞)
    daysUntilExpiration,
    temperature,
    expectedTemperature,
    currentStock,
    reorderPoint,
  },
  
  // –°—Ç–∞—Ç—É—Å
  status,                   // ACTIVE, ACKNOWLEDGED, RESOLVED, DISMISSED
  
  createdAt,
  acknowledgedAt,           // –ö–æ–≥–¥–∞ —É–≤–∏–¥–µ–ª–∏
  acknowledgedBy,           // –ö—Ç–æ —É–≤–∏–¥–µ–ª
  resolvedAt,               // –ö–æ–≥–¥–∞ —Ä–µ—à–∏–ª–∏
}
```

### –°—Ç–∞—Ç—É—Å—ã

```
ACTIVE       ‚Äî –ê–∫—Ç–∏–≤–Ω—ã–π, —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è
ACKNOWLEDGED ‚Äî –£–≤–∏–¥–µ–ª–∏, —Ä–∞–±–æ—Ç–∞–µ–º
RESOLVED     ‚Äî –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞
DISMISSED    ‚Äî –û—Ç–∫–ª–æ–Ω—ë–Ω (–ª–æ–∂–Ω—ã–π –∞–ª–µ—Ä—Ç)
```

---

## –ö–∞–∫ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–ª–µ—Ä—Ç—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ cron

```typescript
// –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 6:00
@Cron('0 6 * * *')
async checkExpiringBatches() {
  // –ù–∞—Ö–æ–¥–∏–º –ø–∞—Ä—Ç–∏–∏ —Å–æ —Å—Ä–æ–∫–æ–º < 7 –¥–Ω–µ–π
  const expiring = await this.batchPort.getExpiring(...);
  
  for (const batch of expiring) {
    const days = daysUntil(batch.expirationDate);
    
    if (days <= 2) {
      await this.alertsPort.create({
        type: AlertType.EXPIRING_CRITICAL,
        severity: AlertSeverity.CRITICAL,
        batch,
        message: `${batch.product.name} –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ ${days} –¥–Ω.`,
      });
    } else if (days <= 7) {
      await this.alertsPort.create({
        type: AlertType.EXPIRING_SOON,
        severity: AlertSeverity.WARNING,
        ...
      });
    }
  }
}

// –ö–∞–∂–¥—ã–π —á–∞—Å
@Cron('0 * * * *')
async checkConditions() {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É/–≤–ª–∞–∂–Ω–æ—Å—Ç—å
  const locations = await this.locationPort.getAll(...);
  
  for (const location of locations) {
    if (location.actualConditions.temperature > location.targetConditions.max) {
      await this.alertsPort.create({
        type: AlertType.TEMPERATURE_DEVIATION,
        severity: AlertSeverity.WARNING,
        location,
        message: `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ${location.actualConditions.temperature}¬∞C (–Ω–æ—Ä–º–∞ ${location.targetConditions.max}¬∞C)`,
      });
    }
  }
}
```

### –ü—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

```typescript
// –ü–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫
async afterSale(product, location) {
  const stock = await this.getStock(product, location);
  
  if (stock < product.reorderPoint) {
    await this.alertsPort.create({
      type: AlertType.LOW_STOCK,
      severity: AlertSeverity.INFO,
      product,
      location,
      message: `${product.name}: –æ—Å—Ç–∞–ª–æ—Å—å ${stock} (–º–∏–Ω. ${product.reorderPoint})`,
      data: {
        currentStock: stock,
        reorderPoint: product.reorderPoint,
      },
    });
  }
}
```

---

## –î—É—Ä–∞–∫–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

**–ê–ª–µ—Ä—Ç—ã –ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏!**

```
–°—Ä–æ–∫ –∏—Å—Ç–µ–∫–∞–µ—Ç ‚Üí –ê–ª–µ—Ä—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è
             ‚Üí –ù–û –º–æ–∂–Ω–æ –ø—Ä–æ–¥–∞—Ç—å —Å–æ —Å–∫–∏–¥–∫–æ–π
             ‚Üí –ù–û –º–æ–∂–Ω–æ —Å–ø–∏—Å–∞—Ç—å
             ‚Üí –ù–û –º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å (–Ω–∞ —Å–≤–æ–π —Ä–∏—Å–∫)
             
–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è ‚Üí –ê–ª–µ—Ä—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è
                        ‚Üí –ù–û –º–æ–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å —Ç–æ–≤–∞—Ä
                        ‚Üí –ù–û –º–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å
                        ‚Üí –ü—Ä–æ—Å—Ç–æ –≤–∏–¥–∏—à—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
```

–ê–ª–µ—Ä—Ç—ã = –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–µ –∑–∞–ø—Ä–µ—Ç.

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã

```typescript
const alerts = await alertsPort.getActive(
  new AlertsQueries.GetActiveAlertsQuery(sellerId),
);

// alerts:
// [
//   {
//     type: 'EXPIRING_CRITICAL',
//     severity: 'CRITICAL',
//     message: '–ú–æ–ª–æ–∫–æ "–ü—Ä–æ—Å—Ç–æ–∫–≤–∞—à–∏–Ω–æ" –∏—Å—Ç–µ–∫–∞–µ—Ç –∑–∞–≤—Ç—Ä–∞',
//     data: { daysUntilExpiration: 1 },
//   },
//   {
//     type: 'TEMPERATURE_DEVIATION',
//     severity: 'WARNING',
//     message: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ #2: 8¬∞C (–Ω–æ—Ä–º–∞ 2-6¬∞C)',
//     data: { temperature: 8, expectedTemperature: 4 },
//   },
// ]
```

### –ü–æ–ª—É—á–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã

```typescript
const critical = await alertsPort.getCritical(
  new AlertsQueries.GetCriticalAlertsQuery(sellerId),
);
```

### –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å (—É–≤–∏–¥–µ–ª)

```typescript
await alertsPort.acknowledge(
  new AlertsCommands.AcknowledgeAlertCommand({
    alertId,
    acknowledgedBy: employeeId,
  }),
);
```

### –†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É

```typescript
await alertsPort.resolve(
  new AlertsCommands.ResolveAlertCommand({
    alertId,
    resolution: '–¢–æ–≤–∞—Ä –ø—Ä–æ–¥–∞–Ω —Å–æ —Å–∫–∏–¥–∫–æ–π 30%',
  }),
);
```

### –û—Ç–∫–ª–æ–Ω–∏—Ç—å (–ª–æ–∂–Ω—ã–π –∞–ª–µ—Ä—Ç)

```typescript
await alertsPort.dismiss(
  new AlertsCommands.DismissAlertCommand({
    alertId,
    reason: '–¢–µ—Ä–º–æ–º–µ—Ç—Ä –Ω–µ–∏—Å–ø—Ä–∞–≤–µ–Ω, –∑–∞–º–µ–Ω–∏–ª–∏',
  }),
);
```

---

## –ü–∞–Ω–µ–ª—å –∞–ª–µ—Ä—Ç–æ–≤ (–ø—Ä–∏–º–µ—Ä UI)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üö® –ê–ª–µ—Ä—Ç—ã                                            [3]    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üî¥ CRITICAL                                                 ‚îÇ
‚îÇ   –ú–æ–ª–æ–∫–æ "–ü—Ä–æ—Å—Ç–æ–∫–≤–∞—à–∏–Ω–æ" –∏—Å—Ç–µ–∫–∞–µ—Ç –∑–∞–≤—Ç—Ä–∞                   ‚îÇ
‚îÇ   –ü–∞—Ä—Ç–∏—è #1234 ‚Ä¢ –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ #1 ‚Ä¢ 5 —à—Ç                     ‚îÇ
‚îÇ   [–°–ø–∏—Å–∞—Ç—å] [–°–∫–∏–¥–∫–∞ 50%] [–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å]                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üü° WARNING                                                  ‚îÇ
‚îÇ   –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ #2: —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 8¬∞C (–Ω–æ—Ä–º–∞ 2-6¬∞C)            ‚îÇ
‚îÇ   –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ: 5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥                       ‚îÇ
‚îÇ   [–ü—Ä–æ–≤–µ—Ä–∏—Ç—å] [–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —Ä–µ–º–æ–Ω—Ç]                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üîµ INFO                                                     ‚îÇ
‚îÇ   –Ø–±–ª–æ–∫–∏ –ì–æ–ª–¥–µ–Ω ‚Äî –æ—Å—Ç–∞–ª–æ—Å—å 3 –∫–≥ (–º–∏–Ω–∏–º—É–º 10 –∫–≥)            ‚îÇ
‚îÇ   –ú–∞–≥–∞–∑–∏–Ω "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π"                                    ‚îÇ
‚îÇ   [–ó–∞–∫–∞–∑–∞—Ç—å] [–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å]                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –≠–∫—Å–ø–æ—Ä—Ç

```typescript
import {
  ALERTS_PORT,
  AlertsPort,
  
  InventoryAlert,
  AlertType,
  AlertSeverity,
  AlertStatus,
  
  AlertsCommands,
  AlertsQueries,
} from 'src/modules/new-inventory/alerts';
```
